<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NEMSU Food Ordering System</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* ====== CSS STYLES ====== */
        :root {
            --primary: #4f46e5;
            --primary-dark: #3730a3;
            --primary-light: #6366f1;
            --secondary: #10b981;
            --secondary-dark: #059669;
            --danger: #ef4444;
            --warning: #f59e0b;
            --info: #3b82f6;
            --light: #f8fafc;
            --dark: #1e293b;
            --gray-50: #f8fafc;
            --gray-100: #f1f5f9;
            --gray-200: #e2e8f0;
            --gray-300: #cbd5e1;
            --gray-400: #94a3b8;
            --gray-500: #64748b;
            --gray-600: #475569;
            --gray-700: #334155;
            --gray-800: #1e293b;
            --gray-900: #0f172a;
            --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
            --shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1);
            --shadow-md: 0 10px 15px -3px rgb(0 0 0 / 0.1);
            --shadow-lg: 0 20px 25px -5px rgb(0 0 0 / 0.1);
            --radius-sm: 0.375rem;
            --radius: 0.5rem;
            --radius-md: 0.75rem;
            --radius-lg: 1rem;
            --radius-xl: 1.5rem;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: var(--gray-800);
            line-height: 1.6;
        }

        #app {
            width: 100%;
            min-height: 100vh;
            background: var(--light);
            position: relative;
            overflow: hidden;
        }

        .screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            overflow-y: auto;
            background: var(--light);
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .screen.active {
            opacity: 1;
            visibility: visible;
            transform: translateX(0);
        }

        .screen:not(.hidden) {
            opacity: 1;
            visibility: visible;
        }

        .hidden {
            display: none !important;
        }

        /* Welcome Screen */
        .welcome-container {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 2rem;
            text-align: center;
        }

        .logo {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 1rem;
            margin-bottom: 1rem;
            flex-wrap: wrap;
        }

        .logo i {
            font-size: 3rem;
            color: #fbbf24;
        }

        .logo h1 {
            font-size: 2.5rem;
            font-weight: 700;
            margin: 0;
        }

        .subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
            margin-bottom: 0.5rem;
        }

        .tagline {
            font-size: 1rem;
            opacity: 0.8;
            margin-bottom: 2rem;
        }

        .welcome-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 2rem 0;
        }

        .food-icons {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 2rem;
            font-size: 4rem;
            margin-bottom: 3rem;
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .start-options {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            width: 100%;
            max-width: 400px;
        }

        .btn-large {
            padding: 1.2rem 2rem;
            font-size: 1.1rem;
            border-radius: var(--radius-lg);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.75rem;
            transition: all 0.3s ease;
            border: none;
            cursor: pointer;
            font-weight: 600;
        }

        .btn-primary {
            background: linear-gradient(to right, var(--primary), var(--primary-light));
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .btn-secondary {
            background: var(--gray-200);
            color: var(--gray-800);
        }

        .btn-danger {
            background: linear-gradient(to right, var(--danger), #f87171);
            color: white;
        }

        .btn-success {
            background: linear-gradient(to right, var(--secondary), #34d399);
            color: white;
        }

        .btn-warning {
            background: linear-gradient(to right, var(--warning), #fbbf24);
            color: white;
        }

        .welcome-footer {
            padding: 2rem;
            text-align: center;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: var(--radius-lg);
        }

        .features {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 1.5rem;
            margin-top: 1rem;
        }

        .features span {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.9rem;
            opacity: 0.9;
        }

        /* Auth Screen */
        .auth-container {
            min-height: 100vh;
            padding: 2rem;
            background: var(--light);
        }

        .auth-header {
            margin-bottom: 3rem;
        }

        .auth-header h2 {
            color: var(--primary);
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .btn-back {
            background: var(--gray-200);
            color: var(--gray-700);
            border: none;
            padding: 0.5rem 1rem;
            border-radius: var(--radius);
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            transition: all 0.3s ease;
            margin-bottom: 1rem;
        }

        .btn-back:hover {
            background: var(--gray-300);
        }

        .auth-options {
            display: grid;
            gap: 1rem;
            max-width: 800px;
            margin: 0 auto;
        }

        .auth-card {
            background: white;
            border-radius: var(--radius-lg);
            padding: 1.5rem;
            display: flex;
            align-items: center;
            gap: 1.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
            box-shadow: var(--shadow);
        }

        .auth-card:hover {
            transform: translateY(-4px);
            border-color: var(--primary);
            box-shadow: var(--shadow-lg);
        }

        .card-icon {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
            border-radius: var(--radius);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.5rem;
        }

        .card-content {
            flex: 1;
        }

        .card-content h3 {
            color: var(--gray-800);
            margin-bottom: 0.25rem;
        }

        .card-content p {
            color: var(--gray-600);
            font-size: 0.9rem;
        }

        /* Form Styles */
        .form-container {
            min-height: 100vh;
            background: var(--light);
            padding: 2rem;
        }

        .form-header {
            margin-bottom: 2rem;
        }

        .form-header h2 {
            color: var(--primary);
            margin: 1rem 0 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .form-content {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: var(--radius-lg);
            padding: 2rem;
            box-shadow: var(--shadow);
        }

        .form-section {
            margin-bottom: 2rem;
        }

        .form-section h3 {
            color: var(--gray-800);
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 1.1rem;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
        }

        .form-group {
            margin-bottom: 1rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: var(--gray-700);
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 0.75rem 1rem;
            border: 2px solid var(--gray-300);
            border-radius: var(--radius);
            font-family: 'Poppins', sans-serif;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
        }

        .form-text {
            display: block;
            margin-top: 0.375rem;
            color: var(--gray-500);
            font-size: 0.875rem;
        }

        .required {
            color: var(--danger);
        }

        /* Role Selector */
        .role-selector {
            margin-bottom: 2rem;
        }

        .role-tabs {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .role-tab {
            flex: 1;
            padding: 1rem;
            background: var(--gray-100);
            border: 2px solid transparent;
            border-radius: var(--radius);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
            font-family: 'Poppins', sans-serif;
            font-size: 1rem;
        }

        .role-tab.active {
            background: white;
            border-color: var(--primary);
            color: var(--primary);
            box-shadow: var(--shadow);
        }

        .role-tab i {
            font-size: 2rem;
        }

        /* Stores Screen */
        .stores-container {
            min-height: 100vh;
            background: var(--light);
        }

        .stores-header {
            background: white;
            padding: 1rem 2rem;
            box-shadow: var(--shadow);
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .header-title h1 {
            font-size: 1.5rem;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .user-profile {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            cursor: pointer;
            padding: 0.5rem;
            border-radius: var(--radius);
            transition: background 0.3s ease;
        }

        .user-profile:hover {
            background: var(--gray-100);
        }

        .avatar {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
        }

        .user-info {
            display: flex;
            flex-direction: column;
        }

        .user-name {
            font-weight: 600;
            color: var(--gray-800);
            font-size: 0.9rem;
        }

        .user-role {
            font-size: 0.75rem;
            color: var(--gray-500);
        }

        .btn-cart {
            position: relative;
            background: none;
            border: none;
            font-size: 1.5rem;
            color: var(--gray-600);
            cursor: pointer;
            padding: 0.5rem;
        }

        .cart-count {
            position: absolute;
            top: -5px;
            right: -5px;
            background: var(--danger);
            color: white;
            font-size: 0.75rem;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .btn-logout {
            background: none;
            border: none;
            font-size: 1.5rem;
            color: var(--gray-600);
            cursor: pointer;
            padding: 0.5rem;
            transition: color 0.3s ease;
        }

        .btn-logout:hover {
            color: var(--danger);
        }

        .stores-content {
            padding: 2rem;
        }

        .stores-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .store-card {
            background: white;
            border-radius: var(--radius-lg);
            overflow: hidden;
            box-shadow: var(--shadow);
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .store-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-lg);
        }

        .store-header {
            padding: 1.5rem;
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
            color: white;
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .store-icon {
            font-size: 2rem;
        }

        .store-info h3 {
            font-size: 1.25rem;
            margin-bottom: 0.25rem;
        }

        .store-rating {
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }

        .store-body {
            padding: 1.5rem;
        }

        .store-description {
            color: var(--gray-600);
            margin-bottom: 1rem;
            font-size: 0.9rem;
        }

        .store-tags {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        .store-tag {
            padding: 0.25rem 0.75rem;
            background: var(--gray-100);
            border-radius: 1rem;
            font-size: 0.75rem;
            color: var(--gray-600);
        }

        .store-footer {
            padding: 1rem 1.5rem;
            background: var(--gray-50);
            border-top: 1px solid var(--gray-200);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .store-status {
            font-size: 0.875rem;
            font-weight: 600;
        }

        .store-status.open {
            color: var(--secondary);
        }

        .store-status.closed {
            color: var(--danger);
        }

        .btn-sm {
            padding: 0.5rem 1rem;
            font-size: 0.875rem;
        }

        /* Menu Screen */
        .menu-container {
            min-height: 100vh;
            background: var(--light);
        }

        .menu-header {
            background: white;
            padding: 1rem;
            box-shadow: var(--shadow);
            display: flex;
            align-items: center;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .header-content {
            flex: 1;
            min-width: 200px;
        }

        .header-content h1 {
            font-size: 1.5rem;
            color: var(--gray-800);
            margin-bottom: 0.25rem;
        }

        .store-meta {
            display: flex;
            gap: 1rem;
            font-size: 0.875rem;
            color: var(--gray-600);
            flex-wrap: wrap;
        }

        .menu-content {
            padding: 1rem;
        }

        .store-banner {
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
            border-radius: var(--radius-lg);
            padding: 2rem;
            margin-bottom: 2rem;
            color: white;
        }

        .banner-content {
            display: flex;
            align-items: center;
            gap: 1.5rem;
            flex-wrap: wrap;
        }

        .store-icon-large {
            font-size: 3rem;
        }

        .store-info p {
            opacity: 0.9;
            margin-bottom: 0.5rem;
        }

        .tag {
            padding: 0.25rem 0.75rem;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 1rem;
            font-size: 0.75rem;
            margin-right: 0.5rem;
        }

        .menu-items {
            display: grid;
            gap: 1rem;
        }

        .menu-item {
            background: white;
            border-radius: var(--radius);
            padding: 1rem;
            display: flex;
            gap: 1rem;
            box-shadow: var(--shadow);
            flex-wrap: wrap;
        }

        .menu-item-content {
            flex: 1;
            min-width: 250px;
        }

        .menu-item-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 0.5rem;
            flex-wrap: wrap;
        }

        .menu-item-title {
            font-weight: 600;
            color: var(--gray-800);
        }

        .menu-item-price {
            font-weight: 700;
            color: var(--primary);
            font-size: 1.25rem;
        }

        .menu-item-description {
            color: var(--gray-600);
            font-size: 0.9rem;
            margin-bottom: 1rem;
        }

        .menu-item-actions {
            display: flex;
            align-items: center;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .quantity-control {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn-quantity {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            border: 2px solid var(--gray-300);
            background: white;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-quantity:hover {
            border-color: var(--primary);
            color: var(--primary);
        }

        .quantity-display {
            min-width: 40px;
            text-align: center;
            font-weight: 600;
        }

        .btn-add {
            padding: 0.5rem 1rem;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: var(--radius);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-add:hover {
            background: var(--primary-dark);
        }

        /* Cart Screen */
        .cart-container {
            min-height: 100vh;
            background: var(--light);
        }

        .cart-header {
            background: white;
            padding: 1rem;
            box-shadow: var(--shadow);
            display: flex;
            align-items: center;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .cart-header h1 {
            flex: 1;
            font-size: 1.5rem;
            color: var(--gray-800);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn-clear {
            background: none;
            border: none;
            color: var(--danger);
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-weight: 600;
        }

        .cart-content {
            padding: 1rem;
            display: grid;
            gap: 2rem;
        }

        .cart-items {
            background: white;
            border-radius: var(--radius-lg);
            overflow: hidden;
            box-shadow: var(--shadow);
        }

        .cart-item {
            padding: 1rem;
            border-bottom: 1px solid var(--gray-200);
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .cart-item:last-child {
            border-bottom: none;
        }

        .cart-item-info {
            flex: 1;
            min-width: 250px;
        }

        .cart-item-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.5rem;
            flex-wrap: wrap;
        }

        .cart-item-title {
            font-weight: 600;
            color: var(--gray-800);
        }

        .cart-item-price {
            font-weight: 700;
            color: var(--primary);
        }

        .cart-item-store {
            color: var(--gray-600);
            font-size: 0.875rem;
            margin-bottom: 1rem;
        }

        .cart-item-actions {
            display: flex;
            align-items: center;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .cart-item-total {
            font-weight: 700;
            color: var(--gray-800);
            min-width: 80px;
            text-align: right;
        }

        .cart-summary {
            background: white;
            border-radius: var(--radius-lg);
            padding: 1.5rem;
            box-shadow: var(--shadow);
        }

        .summary-section {
            margin-bottom: 2rem;
        }

        .summary-section h3 {
            color: var(--gray-800);
            margin-bottom: 1rem;
            font-size: 1.1rem;
        }

        .summary-row {
            display: flex;
            justify-content: space-between;
            padding: 0.5rem 0;
            color: var(--gray-600);
        }

        .summary-row.total {
            border-top: 2px solid var(--gray-300);
            margin-top: 0.5rem;
            padding-top: 1rem;
            font-weight: 700;
            color: var(--gray-800);
            font-size: 1.25rem;
        }

        .btn-checkout {
            width: 100%;
            padding: 1rem;
            font-size: 1.1rem;
            justify-content: center;
            margin-top: 1rem;
        }

        /* Checkout Screen */
        .checkout-container {
            min-height: 100vh;
            background: var(--light);
        }

        .checkout-header {
            background: white;
            padding: 1rem;
            box-shadow: var(--shadow);
            display: flex;
            align-items: center;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .checkout-header h1 {
            flex: 1;
            font-size: 1.5rem;
            color: var(--gray-800);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .checkout-content {
            padding: 1rem;
        }

        .checkout-form {
            background: white;
            border-radius: var(--radius-lg);
            padding: 2rem;
            box-shadow: var(--shadow);
        }

        .payment-options {
            display: grid;
            gap: 1rem;
        }

        .payment-option {
            border: 2px solid var(--gray-300);
            border-radius: var(--radius);
            overflow: hidden;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .payment-option.active {
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
        }

        .option-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
        }

        .option-icon {
            width: 48px;
            height: 48px;
            background: var(--gray-100);
            border-radius: var(--radius);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: var(--primary);
        }

        .option-info {
            flex: 1;
        }

        .option-title {
            font-weight: 600;
            color: var(--gray-800);
            display: block;
        }

        .option-subtitle {
            font-size: 0.875rem;
            color: var(--gray-600);
            display: block;
        }

        .option-check {
            color: var(--primary);
            font-size: 1.5rem;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .payment-option.active .option-check {
            opacity: 1;
        }

        .option-details {
            padding: 1rem;
            background: var(--gray-50);
            border-top: 1px solid var(--gray-200);
            display: none;
        }

        .payment-option.active .option-details {
            display: block;
        }

        .button-group {
            display: flex;
            gap: 1rem;
            margin-top: 2rem;
            flex-wrap: wrap;
        }

        .btn-next, .btn-back {
            flex: 1;
            justify-content: center;
            min-width: 120px;
        }

        /* Receipt Screen */
        .receipt-container {
            min-height: 100vh;
            background: var(--light);
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 2rem;
        }

        .receipt {
            background: white;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-lg);
            max-width: 500px;
            width: 100%;
            overflow: hidden;
        }

        .receipt-header {
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
            color: white;
            padding: 2rem;
            text-align: center;
        }

        .receipt-logo {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 1rem;
            margin-bottom: 1rem;
            flex-wrap: wrap;
        }

        .receipt-logo i {
            font-size: 2.5rem;
        }

        .receipt-logo h2 {
            font-size: 1.5rem;
        }

        .receipt-order-id {
            font-weight: 700;
            font-size: 1.25rem;
            margin-top: 1rem;
        }

        .receipt-body {
            padding: 2rem;
        }

        .info-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.5rem;
            flex-wrap: wrap;
        }

        .info-row .label {
            color: var(--gray-600);
        }

        .receipt-items {
            margin: 2rem 0;
        }

        .receipt-item {
            display: flex;
            justify-content: space-between;
            padding: 0.75rem 0;
            border-bottom: 1px solid var(--gray-200);
            font-size: 0.875rem;
            flex-wrap: wrap;
        }

        .receipt-totals {
            margin-top: 1rem;
        }

        .total-row {
            display: flex;
            justify-content: space-between;
            padding: 0.5rem 0;
            color: var(--gray-600);
        }

        .total-row.grand-total {
            border-top: 2px solid var(--gray-300);
            margin-top: 0.5rem;
            padding-top: 1rem;
            font-weight: 700;
            color: var(--gray-800);
            font-size: 1.25rem;
        }

        .receipt-footer {
            margin-top: 2rem;
            padding-top: 1rem;
            border-top: 2px dashed var(--gray-300);
        }

        .receipt-actions {
            display: flex;
            gap: 1rem;
            padding: 1rem 2rem 2rem;
            flex-wrap: wrap;
        }

        .receipt-actions button {
            flex: 1;
            justify-content: center;
            min-width: 120px;
        }

        .receipt-thanks {
            padding: 1rem 2rem 2rem;
            text-align: center;
            color: var(--gray-600);
            border-top: 1px solid var(--gray-200);
        }

        /* Admin Dashboard */
        .admin-container {
            min-height: 100vh;
            background: var(--light);
        }

        .admin-header {
            background: white;
            padding: 1rem 2rem;
            box-shadow: var(--shadow);
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .admin-header h1 {
            font-size: 1.5rem;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .admin-content {
            padding: 2rem;
        }

        .admin-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: white;
            border-radius: var(--radius-lg);
            padding: 1.5rem;
            box-shadow: var(--shadow);
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .stat-icon {
            width: 60px;
            height: 60px;
            border-radius: var(--radius);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: white;
        }

        .stat-info h3 {
            font-size: 2rem;
            color: var(--gray-800);
            margin-bottom: 0.25rem;
        }

        .stat-info p {
            color: var(--gray-600);
            font-size: 0.875rem;
        }

        .admin-tabs {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 2rem;
            border-bottom: 2px solid var(--gray-200);
            padding-bottom: 0.5rem;
            flex-wrap: wrap;
        }

        .admin-tab {
            padding: 0.75rem 1.5rem;
            background: var(--gray-100);
            border: none;
            border-radius: var(--radius);
            cursor: pointer;
            font-weight: 600;
            color: var(--gray-600);
            transition: all 0.3s ease;
        }

        .admin-tab.active {
            background: var(--primary);
            color: white;
        }

        .tab-content {
            background: white;
            border-radius: var(--radius-lg);
            padding: 2rem;
            box-shadow: var(--shadow);
        }

        .tab-pane {
            display: none;
        }

        .tab-pane.active {
            display: block;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
        }

        .data-table th {
            background: var(--gray-100);
            padding: 1rem;
            text-align: left;
            font-weight: 600;
            color: var(--gray-700);
            border-bottom: 2px solid var(--gray-200);
        }

        .data-table td {
            padding: 1rem;
            border-bottom: 1px solid var(--gray-200);
            color: var(--gray-600);
        }

        .data-table tr:hover {
            background: var(--gray-50);
        }

        .badge {
            padding: 0.25rem 0.75rem;
            border-radius: 1rem;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .badge-success {
            background: #d1fae5;
            color: #065f46;
        }

        .badge-warning {
            background: #fef3c7;
            color: #92400e;
        }

        .badge-danger {
            background: #fee2e2;
            color: #991b1b;
        }

        .chart-container {
            height: 300px;
            margin: 2rem 0;
        }

        .search-bar {
            margin-bottom: 1.5rem;
        }

        .search-bar input {
            width: 100%;
            padding: 0.75rem 1rem;
            border: 2px solid var(--gray-300);
            border-radius: var(--radius);
            font-size: 1rem;
        }

        /* Database Connection Status */
        .db-status {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            border-radius: var(--radius);
            font-size: 0.875rem;
            font-weight: 600;
        }

        .db-status.connected {
            background: #d1fae5;
            color: #065f46;
        }

        .db-status.disconnected {
            background: #fee2e2;
            color: #991b1b;
        }

        /* Modals */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            backdrop-filter: blur(4px);
        }

        .modal-content {
            background: white;
            border-radius: var(--radius-lg);
            padding: 2rem;
            max-width: 400px;
            width: 90%;
            box-shadow: var(--shadow-lg);
            text-align: center;
        }

        .alert-icon {
            font-size: 3rem;
            color: var(--secondary);
            margin-bottom: 1rem;
        }

        #alert-title {
            color: var(--gray-800);
            margin-bottom: 0.5rem;
        }

        #alert-message {
            color: var(--gray-600);
            margin-bottom: 1.5rem;
        }

        /* Guest Restriction Modal */
        .guest-restriction-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            backdrop-filter: blur(4px);
        }

        .guest-restriction-content {
            background: white;
            border-radius: var(--radius-lg);
            padding: 2rem;
            max-width: 400px;
            width: 90%;
            box-shadow: var(--shadow-lg);
            text-align: center;
        }

        .guest-icon {
            font-size: 3rem;
            color: var(--warning);
            margin-bottom: 1rem;
        }

        .guest-buttons {
            display: flex;
            gap: 1rem;
            margin-top: 1.5rem;
            flex-wrap: wrap;
        }

        .guest-buttons button {
            flex: 1;
            min-width: 120px;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .logo h1 {
                font-size: 2rem;
            }
            
            .food-icons {
                font-size: 3rem;
                gap: 1rem;
            }
            
            .auth-options {
                grid-template-columns: 1fr;
            }
            
            .form-content {
                padding: 1rem;
            }
            
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .stores-grid {
                grid-template-columns: 1fr;
            }
            
            .stores-header {
                padding: 1rem;
                flex-direction: column;
                gap: 1rem;
            }
            
            .role-tabs {
                flex-direction: column;
            }
            
            .menu-header {
                flex-direction: column;
                gap: 0.5rem;
                text-align: center;
            }
            
            .banner-content {
                flex-direction: column;
                text-align: center;
            }
            
            .receipt-actions {
                flex-direction: column;
            }
            
            .button-group {
                flex-direction: column;
            }
            
            .admin-stats {
                grid-template-columns: 1fr;
            }
            
            .data-table {
                display: block;
                overflow-x: auto;
            }
        }

        @media (max-width: 480px) {
            .logo {
                flex-direction: column;
                text-align: center;
            }
            
            .logo h1 {
                font-size: 1.75rem;
            }
            
            .btn-large {
                padding: 1rem;
                font-size: 1rem;
            }
            
            .auth-card {
                flex-direction: column;
                text-align: center;
                padding: 1rem;
            }
            
            .card-icon {
                width: 48px;
                height: 48px;
                font-size: 1.25rem;
            }
            
            .form-header h2 {
                font-size: 1.5rem;
            }
            
            .cart-item {
                flex-direction: column;
            }
            
            .cart-item-actions {
                justify-content: space-between;
            }
            
            .admin-tabs {
                flex-direction: column;
            }
        }

        /* Animations */
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .screen:not(.hidden) {
            animation: fadeIn 0.5s ease-out;
        }

        /* Print Styles */
        @media print {
            body * {
                visibility: hidden;
            }
            
            .receipt,
            .receipt * {
                visibility: visible;
            }
            
            .receipt {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
                box-shadow: none;
            }
            
            .receipt-actions,
            .receipt-thanks {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div id="app">
        <!-- Welcome Screen -->
        <div id="welcome-screen" class="screen">
            <div class="welcome-container">
                <div class="logo">
                    <i class="fas fa-utensils"></i>
                    <h1>NEMSU CHOW ZONE</h1>
                </div>
                <p class="subtitle">Food Ordering System</p>
                <p class="tagline">Order your favorite campus food with just a few clicks!</p>
                
                <div class="welcome-content">
                    <div class="food-icons">
                        <i class="fas fa-hamburger"></i>
                        <i class="fas fa-pizza-slice"></i>
                        <i class="fas fa-ice-cream"></i>
                        <i class="fas fa-coffee"></i>
                        <i class="fas fa-bread-slice"></i>
                    </div>
                    
                    <div class="start-options">
                        <button onclick="showAuthOptions()" class="btn-primary btn-large">
                            <i class="fas fa-play-circle"></i> START ORDERING
                        </button>
                        <button onclick="showAdminLogin()" class="btn-warning btn-large">
                            <i class="fas fa-user-shield"></i> ADMIN LOGIN
                        </button>
                        <button onclick="showAbout()" class="btn-secondary btn-large">
                            <i class="fas fa-info-circle"></i> ABOUT SYSTEM
                        </button>
                        <button onclick="exitApp()" class="btn-danger btn-large">
                            <i class="fas fa-sign-out-alt"></i> EXIT SYSTEM
                        </button>
                    </div>
                </div>
                
                <div class="welcome-footer">
                    <p>For NEMSU Students & Instructors</p>
                    <div class="features">
                        <span><i class="fas fa-check-circle"></i> Easy Registration</span>
                        <span><i class="fas fa-check-circle"></i> Multiple Stores</span>
                        <span><i class="fas fa-check-circle"></i> Secure Payment</span>
                        <span><i class="fas fa-check-circle"></i> Admin Dashboard</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Authentication Options -->
        <div id="auth-screen" class="screen hidden">
            <div class="auth-container">
                <div class="auth-header">
                    <button onclick="backToWelcome()" class="btn-back">
                        <i class="fas fa-arrow-left"></i> Back
                    </button>
                    <h2><i class="fas fa-user-circle"></i> Welcome to NEMSU Chow Zone</h2>
                    <p>Please choose an option to continue</p>
                </div>
                
                <div class="auth-options">
                    <div class="auth-card" onclick="showRegister()">
                        <div class="card-icon">
                            <i class="fas fa-user-plus"></i>
                        </div>
                        <div class="card-content">
                            <h3>Register Account</h3>
                            <p>Create a new student or instructor account</p>
                        </div>
                    </div>
                    
                    <div class="auth-card" onclick="showLogin()">
                        <div class="card-icon">
                            <i class="fas fa-sign-in-alt"></i>
                        </div>
                        <div class="card-content">
                            <h3>Login to Account</h3>
                            <p>Access your existing account</p>
                        </div>
                    </div>
                    
                    <div class="auth-card" onclick="continueAsGuest()">
                        <div class="card-icon">
                            <i class="fas fa-user-clock"></i>
                        </div>
                        <div class="card-content">
                            <h3>Continue as Guest</h3>
                            <p>Browse stores and menu items only</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Registration Form -->
        <div id="register-screen" class="screen hidden">
            <div class="form-container">
                <div class="form-header">
                    <button onclick="backToAuth()" class="btn-back">
                        <i class="fas fa-arrow-left"></i> Back
                    </button>
                    <h2><i class="fas fa-user-plus"></i> Create Account</h2>
                    <p>Join NEMSU Chow Zone community</p>
                </div>

                <div class="form-content">
                    <div class="role-selector">
                        <div class="role-tabs">
                            <button id="student-tab" class="role-tab active" onclick="selectRole('student')">
                                <i class="fas fa-graduation-cap"></i>
                                <span>Student</span>
                            </button>
                            <button id="instructor-tab" class="role-tab" onclick="selectRole('instructor')">
                                <i class="fas fa-chalkboard-teacher"></i>
                                <span>Instructor</span>
                            </button>
                        </div>
                    </div>

                    <form id="register-form" onsubmit="registerUser(event)">
                        <div class="form-section">
                            <h3><i class="fas fa-user"></i> Personal Information</h3>
                            <div class="form-grid">
                                <div class="form-group">
                                    <label>First Name <span class="required">*</span></label>
                                    <input type="text" id="first-name" required>
                                </div>
                                <div class="form-group">
                                    <label>Last Name <span class="required">*</span></label>
                                    <input type="text" id="last-name" required>
                                </div>
                                <div class="form-group">
                                    <label>Middle Name <span class="required">*</span></label>
                                    <input type="text" id="middle-name" required>
                                </div>
                                <div class="form-group">
                                    <label>Age <span class="required">*</span></label>
                                    <input type="number" id="age" min="15" max="80" required>
                                </div>
                            </div>
                        </div>

                        <div class="form-section">
                            <h3><i class="fas fa-graduation-cap"></i> Academic Information</h3>
                            <div id="academic-fields">
                                <div class="form-group">
                                    <label>Course <span class="required">*</span></label>
                                    <select id="course" required>
                                        <option value="">Select Course</option>
                                        <option value="BSIT">BS Information Technology</option>
                                        <option value="BSCS">BS Computer Science</option>
                                        <option value="BSIS">BS Information Systems</option>
                                        <option value="BSEd">BS Education</option>
                                        <option value="BSBA">BS Business Administration</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <div class="form-section">
                            <h3><i class="fas fa-address-book"></i> Contact Information</h3>
                            <div class="form-grid">
                                <div class="form-group">
                                    <label>Phone Number <span class="required">*</span></label>
                                    <input type="tel" id="phone" pattern="09[0-9]{9}" placeholder="09123456789" required>
                                    <small class="form-text">Format: 09XXXXXXXXX (11 digits)</small>
                                </div>
                                <div class="form-group">
                                    <label>Email Address <span class="required">*</span></label>
                                    <input type="email" id="email" placeholder="example@gmail.com" required>
                                    <small class="form-text">Must be a Gmail address</small>
                                </div>
                            </div>
                        </div>

                        <div class="form-section">
                            <h3><i class="fas fa-lock"></i> Security</h3>
                            <div class="form-grid">
                                <div class="form-group">
                                    <label>Password <span class="required">*</span></label>
                                    <input type="password" id="password" minlength="4" maxlength="21" required>
                                    <small class="form-text">4-21 characters</small>
                                </div>
                                <div class="form-group">
                                    <label>Confirm Password <span class="required">*</span></label>
                                    <input type="password" id="confirm-password" required>
                                </div>
                            </div>
                        </div>

                        <div class="button-group">
                            <button type="submit" class="btn-primary">
                                <i class="fas fa-user-check"></i> Create Account
                            </button>
                            <button type="button" onclick="backToAuth()" class="btn-secondary">
                                Cancel
                            </button>
                        </div>
                        
                        <p style="margin-top: 1rem; text-align: center;">
                            Already have an account? <a href="#" onclick="showLogin()" style="color: var(--primary);">Login here</a>
                        </p>
                    </form>
                </div>
            </div>
        </div>

        <!-- Login Form -->
        <div id="login-screen" class="screen hidden">
            <div class="form-container">
                <div class="form-header">
                    <button onclick="backToAuth()" class="btn-back">
                        <i class="fas fa-arrow-left"></i> Back
                    </button>
                    <h2><i class="fas fa-sign-in-alt"></i> Welcome Back</h2>
                    <p>Login to your NEMSU Chow Zone account</p>
                </div>

                <div class="form-content">
                    <form id="login-form" onsubmit="loginUser(event)">
                        <div class="form-group">
                            <label>Email Address</label>
                            <input type="email" id="login-email" placeholder="your@gmail.com" required>
                        </div>

                        <div class="form-group">
                            <label>Password</label>
                            <input type="password" id="login-password" required>
                        </div>

                        <button type="submit" class="btn-primary" style="width: 100%; padding: 1rem;">
                            <i class="fas fa-sign-in-alt"></i> Login to Account
                        </button>
                        
                        <p style="margin-top: 1rem; text-align: center;">
                            Don't have an account? <a href="#" onclick="showRegister()" style="color: var(--primary);">Register here</a>
                        </p>
                        <p style="text-align: center; margin-top: 0.5rem;">
                            <a href="#" onclick="continueAsGuest()" style="color: var(--primary);">Continue as guest</a>
                        </p>
                    </form>
                </div>
            </div>
        </div>

        <!-- Admin Login Screen -->
        <div id="admin-login-screen" class="screen hidden">
            <div class="form-container">
                <div class="form-header">
                    <button onclick="backToWelcome()" class="btn-back">
                        <i class="fas fa-arrow-left"></i> Back
                    </button>
                    <h2><i class="fas fa-user-shield"></i> Admin Login</h2>
                    <p>Access administrative dashboard</p>
                </div>

                <div class="form-content">
                    <form id="admin-login-form" onsubmit="adminLogin(event)">
                        <div class="form-group">
                            <label>Admin Username</label>
                            <input type="text" id="admin-username" placeholder="admin" required>
                        </div>

                        <div class="form-group">
                            <label>Admin Password</label>
                            <input type="password" id="admin-password" required>
                        </div>

                        <button type="submit" class="btn-warning" style="width: 100%; padding: 1rem;">
                            <i class="fas fa-sign-in-alt"></i> Login as Admin
                        </button>
                        
                        <div style="margin-top: 1rem; text-align: center;">
                            <span class="db-status" id="db-status">
                                <i class="fas fa-database"></i> Database: Checking...
                            </span>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Admin Dashboard -->
        <div id="admin-dashboard" class="screen hidden">
            <div class="admin-container">
                <header class="admin-header">
                    <div class="header-left">
                        <h1><i class="fas fa-tachometer-alt"></i> Admin Dashboard</h1>
                        <p style="color: var(--gray-600); font-size: 0.9rem;">Manage NEMSU Chow Zone System</p>
                    </div>
                    
                    <div class="header-right">
                        <span class="db-status connected" id="dashboard-db-status">
                            <i class="fas fa-database"></i> Database: Connected
                        </span>
                        <button onclick="syncDatabase()" class="btn-primary btn-sm">
                            <i class="fas fa-sync"></i> Sync
                        </button>
                        <button onclick="exportData()" class="btn-success btn-sm">
                            <i class="fas fa-download"></i> Export JSON
                        </button>
                        <button onclick="exportToSQLite()" class="btn-success btn-sm">
                            <i class="fas fa-database"></i> Export SQL
                        </button>
                        <button onclick="adminLogout()" class="btn-danger">
                            <i class="fas fa-sign-out-alt"></i> Logout
                        </button>
                    </div>
                </header>

                <div class="admin-content">
                    <div class="admin-stats">
                        <div class="stat-card">
                            <div class="stat-icon" style="background: var(--primary);">
                                <i class="fas fa-users"></i>
                            </div>
                            <div class="stat-info">
                                <h3 id="total-users">0</h3>
                                <p>Total Users</p>
                            </div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-icon" style="background: var(--secondary);">
                                <i class="fas fa-shopping-cart"></i>
                            </div>
                            <div class="stat-info">
                                <h3 id="total-orders">0</h3>
                                <p>Total Orders</p>
                            </div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-icon" style="background: var(--warning);">
                                <i class="fas fa-store"></i>
                            </div>
                            <div class="stat-info">
                                <h3 id="total-stores">0</h3>
                                <p>Active Stores</p>
                            </div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-icon" style="background: var(--info);">
                                <i class="fas fa-money-bill-wave"></i>
                            </div>
                            <div class="stat-info">
                                <h3 id="total-revenue">0</h3>
                                <p>Total Revenue</p>
                            </div>
                        </div>
                    </div>

                    <div class="chart-container">
                        <canvas id="salesChart"></canvas>
                    </div>

                    <div class="admin-tabs">
                        <button class="admin-tab active" onclick="showTab('users', event)">
                            <i class="fas fa-users"></i> Users
                        </button>
                        <button class="admin-tab" onclick="showTab('orders', event)">
                            <i class="fas fa-shopping-cart"></i> Orders
                        </button>
                        <button class="admin-tab" onclick="showTab('inventory', event)">
                            <i class="fas fa-boxes"></i> Inventory
                        </button>
                        <button class="admin-tab" onclick="showTab('analytics', event)">
                            <i class="fas fa-chart-line"></i> Analytics
                        </button>
                    </div>

                    <div class="tab-content">
                        <!-- Users Tab -->
                        <div id="users-tab" class="tab-pane active">
                            <div class="search-bar">
                                <input type="text" id="user-search" placeholder="Search users by name, email, or role..." onkeyup="searchUsers()">
                            </div>
                            <div style="overflow-x: auto;">
                                <table class="data-table">
                                    <thead>
                                        <tr>
                                            <th>ID</th>
                                            <th>Name</th>
                                            <th>Email</th>
                                            <th>Role</th>
                                            <th>Phone</th>
                                            <th>Registered</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="users-table-body">
                                        <!-- Users will be loaded here -->
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <!-- Orders Tab -->
                        <div id="orders-tab" class="tab-pane">
                            <div class="search-bar">
                                <input type="text" id="order-search" placeholder="Search orders by ID, customer, or status..." onkeyup="searchOrders()">
                            </div>
                            <div style="overflow-x: auto;">
                                <table class="data-table">
                                    <thead>
                                        <tr>
                                            <th>Order ID</th>
                                            <th>Customer</th>
                                            <th>Items</th>
                                            <th>Total</th>
                                            <th>Payment</th>
                                            <th>Status</th>
                                            <th>Date</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="orders-table-body">
                                        <!-- Orders will be loaded here -->
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <!-- Inventory Tab -->
                        <div id="inventory-tab" class="tab-pane">
                            <div class="search-bar">
                                <input type="text" id="inventory-search" placeholder="Search inventory by item name or store..." onkeyup="searchInventory()">
                            </div>
                            <div style="overflow-x: auto;">
                                <table class="data-table">
                                    <thead>
                                        <tr>
                                            <th>Store</th>
                                            <th>Item Name</th>
                                            <th>Price</th>
                                            <th>Stock</th>
                                            <th>Status</th>
                                            <th>Last Updated</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="inventory-table-body">
                                        <!-- Inventory will be loaded here -->
                                    </tbody>
                                </table>
                            </div>
                            <button onclick="updateAllInventory()" class="btn-primary" style="margin-top: 1rem;">
                                <i class="fas fa-sync"></i> Update All Inventory
                            </button>
                        </div>

                        <!-- Analytics Tab -->
                        <div id="analytics-tab" class="tab-pane">
                            <div class="form-grid" style="margin-bottom: 2rem;">
                                <div class="form-group">
                                    <label>Date Range</label>
                                    <select id="analytics-range" onchange="updateAnalytics()">
                                        <option value="today">Today</option>
                                        <option value="week">This Week</option>
                                        <option value="month" selected>This Month</option>
                                        <option value="year">This Year</option>
                                        <option value="all">All Time</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>Report Type</label>
                                    <select id="analytics-type" onchange="updateAnalytics()">
                                        <option value="sales">Sales Report</option>
                                        <option value="users">User Growth</option>
                                        <option value="popular">Popular Items</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="chart-container">
                                <canvas id="analyticsChart"></canvas>
                            </div>
                            
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1.5rem; margin-top: 2rem;">
                                <div style="background: white; padding: 1.5rem; border-radius: var(--radius); box-shadow: var(--shadow);">
                                    <h3 style="margin-bottom: 1rem;">Top Selling Items</h3>
                                    <div id="top-items-list">
                                        <!-- Top items will be loaded here -->
                                    </div>
                                </div>
                                <div style="background: white; padding: 1.5rem; border-radius: var(--radius); box-shadow: var(--shadow);">
                                    <h3 style="margin-bottom: 1rem;">Recent Activity</h3>
                                    <div id="recent-activity">
                                        <!-- Recent activity will be loaded here -->
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Stores Screen -->
        <div id="stores-screen" class="screen hidden">
            <div class="stores-container">
                <header class="stores-header">
                    <div class="header-left">
                        <div class="header-title">
                            <h1><i class="fas fa-store"></i> CHOWZONE STORES</h1>
                            <p style="color: var(--gray-600); font-size: 0.9rem;">Browse our campus food vendors</p>
                        </div>
                    </div>
                    
                    <div class="header-right">
                        <div class="user-profile">
                            <div class="avatar">
                                <i class="fas fa-user"></i>
                            </div>
                            <div class="user-info">
                                <span class="user-name" id="user-name">Guest User</span>
                                <span class="user-role" id="user-role">Guest</span>
                            </div>
                        </div>
                        
                        <button onclick="viewCart()" class="btn-cart">
                            <i class="fas fa-shopping-cart"></i>
                            <span class="cart-count" id="cart-count">0</span>
                        </button>
                        
                        <button onclick="logout()" class="btn-logout">
                            <i class="fas fa-sign-out-alt"></i>
                        </button>
                    </div>
                </header>

                <div class="stores-content">
                    <div class="stores-grid" id="stores-list">
                        <!-- Stores will be loaded here -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Store Menu Screen -->
        <div id="menu-screen" class="screen hidden">
            <div class="menu-container">
                <header class="menu-header">
                    <button onclick="backToStores()" class="btn-back">
                        <i class="fas fa-arrow-left"></i>
                    </button>
                    <div class="header-content">
                        <h1 id="store-name">Store Name</h1>
                        <div class="store-meta">
                            <span class="rating">
                                <i class="fas fa-star"></i> 4.5
                            </span>
                            <span class="status open">
                                <i class="fas fa-circle"></i> Open
                            </span>
                            <span class="delivery-time">
                                <i class="fas fa-clock"></i> 15-20 mins
                            </span>
                        </div>
                    </div>
                    <button onclick="viewCart()" class="btn-cart">
                        <i class="fas fa-shopping-cart"></i>
                        <span class="cart-count" id="menu-cart-count">0</span>
                    </button>
                </header>

                <div class="menu-content">
                    <div class="store-banner">
                        <div class="banner-content">
                            <div class="store-icon-large" id="store-icon">
                                <i class="fas fa-store"></i>
                            </div>
                            <div class="store-info">
                                <p id="store-description">Store description goes here</p>
                                <div class="store-tags">
                                    <span class="tag" id="store-category">Category</span>
                                    <span class="tag" id="store-price-range"></span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="menu-items" id="menu-list">
                        <!-- Menu items will be loaded here -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Cart Screen -->
        <div id="cart-screen" class="screen hidden">
            <div class="cart-container">
                <header class="cart-header">
                    <button onclick="backToMenu()" class="btn-back">
                        <i class="fas fa-arrow-left"></i>
                    </button>
                    <h1><i class="fas fa-shopping-cart"></i> Your Order</h1>
                    <button onclick="clearCart()" class="btn-clear">
                        <i class="fas fa-trash"></i> Clear
                    </button>
                </header>

                <div class="cart-content">
                    <div class="cart-items" id="cart-items">
                        <!-- Cart items will be loaded here -->
                    </div>
                    
                    <div class="cart-summary">
                        <div class="summary-section">
                            <h3>Order Summary</h3>
                            <div class="summary-row">
                                <span>Subtotal</span>
                                <span id="cart-subtotal">0.00</span>
                            </div>
                            <div class="summary-row">
                                <span>Delivery Fee</span>
                                <span id="delivery-fee">20.00</span>
                            </div>
                            <div class="summary-row">
                                <span>Service Fee</span>
                                <span id="service-fee">5.00</span>
                            </div>
                            <div class="summary-row total">
                                <span>Total Amount</span>
                                <span id="cart-total">0.00</span>
                            </div>
                        </div>
                        
                        <button onclick="checkout()" class="btn-primary btn-checkout">
                            <i class="fas fa-credit-card"></i> Proceed to Checkout
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Checkout Screen -->
        <div id="checkout-screen" class="screen hidden">
            <div class="checkout-container">
                <header class="checkout-header">
                    <button onclick="backToCart()" class="btn-back">
                        <i class="fas fa-arrow-left"></i>
                    </button>
                    <h1><i class="fas fa-credit-card"></i> Checkout</h1>
                </header>

                <div class="checkout-content">
                    <div class="checkout-form">
                        <form id="checkout-form" onsubmit="placeOrder(event)">
                            <div class="form-section">
                                <h3><i class="fas fa-phone"></i> Contact Information</h3>
                                <div class="form-grid">
                                    <div class="form-group">
                                        <label>Phone Number <span class="required">*</span></label>
                                        <input type="tel" id="checkout-phone" pattern="09[0-9]{9}" placeholder="09123456789" required>
                                        <small class="form-text">For delivery updates</small>
                                    </div>
                                </div>
                            </div>

                            <div class="form-section">
                                <h3><i class="fas fa-wallet"></i> Payment Method</h3>
                                <div class="payment-options">
                                    <div class="payment-option active" onclick="selectPayment('gcash')">
                                        <div class="option-header">
                                            <div class="option-icon">
                                                <i class="fas fa-mobile-alt"></i>
                                            </div>
                                            <div class="option-info">
                                                <span class="option-title">GCash</span>
                                                <span class="option-subtitle">Pay via GCash</span>
                                            </div>
                                            <div class="option-check">
                                                <i class="fas fa-check-circle"></i>
                                            </div>
                                        </div>
                                        <div class="option-details">
                                            <div class="form-group">
                                                <label>GCash Mobile Number <span class="required">*</span></label>
                                                <input type="tel" id="gcash-number" pattern="09[0-9]{9}" placeholder="09123456789">
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="payment-option" onclick="selectPayment('paymaya')">
                                        <div class="option-header">
                                            <div class="option-icon">
                                                <i class="fas fa-credit-card"></i>
                                            </div>
                                            <div class="option-info">
                                                <span class="option-title">PayMaya</span>
                                                <span class="option-subtitle">Pay via PayMaya Wallet</span>
                                            </div>
                                            <div class="option-check">
                                                <i class="fas fa-check-circle"></i>
                                            </div>
                                        </div>
                                        <div class="option-details">
                                            <div class="form-group">
                                                <label>PayMaya Wallet Number <span class="required">*</span></label>
                                                <input type="tel" id="paymaya-number" pattern="09[0-9]{9}" placeholder="09123456789">
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="payment-option" onclick="selectPayment('cod')">
                                        <div class="option-header">
                                            <div class="option-icon">
                                                <i class="fas fa-money-bill-wave"></i>
                                            </div>
                                            <div class="option-info">
                                                <span class="option-title">Cash on Delivery</span>
                                                <span class="option-subtitle">Pay when you receive</span>
                                            </div>
                                            <div class="option-check">
                                                <i class="fas fa-check-circle"></i>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="form-section">
                                <h3><i class="fas fa-map-marker-alt"></i> Delivery Address</h3>
                                <div class="form-group">
                                    <label>Address <span class="required">*</span></label>
                                    <textarea id="delivery-address" rows="3" placeholder="Enter your delivery address..." required></textarea>
                                </div>
                            </div>

                            <div class="button-group">
                                <button type="button" class="btn-secondary btn-back" onclick="backToCart()">
                                    <i class="fas fa-arrow-left"></i> Back to Cart
                                </button>
                                <button type="submit" class="btn-primary">
                                    <i class="fas fa-check-circle"></i> Place Order
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>

        <!-- Receipt Screen -->
        <div id="receipt-screen" class="screen hidden">
            <div class="receipt-container">
                <div class="receipt">
                    <div class="receipt-header">
                        <div class="receipt-logo">
                            <i class="fas fa-utensils"></i>
                            <h2>NEMSU CHOW ZONE</h2>
                        </div>
                        <p style="opacity: 0.9;">Food Ordering System</p>
                        <p class="receipt-order-id">Order #<span id="order-id">123456</span></p>
                    </div>
                    
                    <div class="receipt-body">
                        <div class="receipt-info">
                            <div class="info-row">
                                <span class="label">Date:</span>
                                <span id="receipt-date">Nov 30, 2023 14:30</span>
                            </div>
                            <div class="info-row">
                                <span class="label">Customer:</span>
                                <span id="receipt-customer">John Doe</span>
                            </div>
                            <div class="info-row">
                                <span class="label">Phone:</span>
                                <span id="receipt-phone">09123456789</span>
                            </div>
                        </div>
                        
                        <div class="receipt-items" id="receipt-items">
                            <!-- Receipt items will be loaded here -->
                        </div>
                        
                        <div class="receipt-totals">
                            <div class="total-row">
                                <span>Subtotal:</span>
                                <span id="receipt-subtotal">0.00</span>
                            </div>
                            <div class="total-row">
                                <span>Delivery Fee:</span>
                                <span id="receipt-delivery">20.00</span>
                            </div>
                            <div class="total-row">
                                <span>Service Fee:</span>
                                <span id="receipt-service">5.00</span>
                            </div>
                            <div class="total-row grand-total">
                                <span>Total Amount:</span>
                                <span id="receipt-total">0.00</span>
                            </div>
                        </div>
                        
                        <div class="receipt-footer">
                            <div class="info-row">
                                <span class="label">Payment Method:</span>
                                <span id="receipt-payment">GCash</span>
                            </div>
                            <div class="info-row">
                                <span class="label">Payment Number:</span>
                                <span id="receipt-payment-number">09123456789</span>
                            </div>
                            <div class="info-row">
                                <span class="label">Status:</span>
                                <span style="color: var(--secondary); font-weight: 600;">CONFIRMED</span>
                            </div>
                            <div class="info-row">
                                <span class="label">Delivery:</span>
                                <span>20-30 minutes</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="receipt-actions">
                        <button onclick="printReceipt()" class="btn-primary">
                            <i class="fas fa-print"></i> Print Receipt
                        </button>
                        <button onclick="newOrder()" class="btn-secondary">
                            <i class="fas fa-utensils"></i> New Order
                        </button>
                        <button onclick="saveToDatabase()" class="btn-success">
                            <i class="fas fa-save"></i> Save to DB
                        </button>
                    </div>
                    
                    <div class="receipt-thanks">
                        <p>Thank you for ordering from NEMSU Chow Zone!</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Alert Modal -->
        <div id="alert-modal" class="modal hidden">
            <div class="modal-content">
                <div class="alert-icon" id="alert-icon">
                    <i class="fas fa-check-circle"></i>
                </div>
                <h3 id="alert-title">Success</h3>
                <p id="alert-message">Operation completed successfully</p>
                <button onclick="closeAlert()" class="btn-primary" style="width: 100%; padding: 0.75rem;">OK</button>
            </div>
        </div>

        <!-- Guest Restriction Modal -->
        <div id="guest-restriction-modal" class="guest-restriction-modal hidden">
            <div class="guest-restriction-content">
                <div class="guest-icon">
                    <i class="fas fa-exclamation-circle"></i>
                </div>
                <h3 id="guest-alert-title">Registration Required</h3>
                <p id="guest-alert-message">Guest users can only browse stores and view menu items. To place an order, please register or login first.</p>
                <div class="guest-buttons">
                    <button onclick="showRegister()" class="btn-primary">
                        <i class="fas fa-user-plus"></i> Register
                    </button>
                    <button onclick="showLogin()" class="btn-success">
                        <i class="fas fa-sign-in-alt"></i> Login
                    </button>
                    <button onclick="closeGuestRestriction()" class="btn-secondary">
                        <i class="fas fa-times"></i> Cancel
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ====== JAVASCRIPT CODE ======
        
        // Application State
        let currentUser = null;
        let cart = [];
        let currentStore = null;
        let selectedPayment = 'gcash';
        let userRole = 'student';
        let isDatabaseConnected = false;
        let salesChart = null;
        let analyticsChart = null;
        let isGuestMode = false;
        
        // Database Configuration
        const DB_NAME = 'NEMSU_FOOD_DB';
        const DB_VERSION = 3;
        
        // Database Schema
        const DB_SCHEMA = {
            users: {
                key: 'id',
                indexes: ['email', 'phone', 'role', 'registrationDate']
            },
            orders: {
                key: 'id',
                indexes: ['customerId', 'date', 'status', 'paymentMethod', 'total']
            },
            stores: {
                key: 'id',
                indexes: ['name', 'category', 'status']
            },
            inventory: {
                key: 'id',
                indexes: ['storeId', 'itemName', 'stock']
            },
            transactions: {
                key: 'id',
                indexes: ['orderId', 'paymentMethod', 'date', 'amount']
            }
        };

        // Data Models with Inventory
        const stores = [
            {
                id: 1,
                name: "SWEET CORNER",
                icon: "fas fa-candy-cane",
                description: "Sweet corn delicacies and desserts",
                category: "desserts",
                rating: 4.5,
                status: "open",
                deliveryTime: "15-20 mins",
                priceRange: "",
                menu: [
                    { id: 1, name: "Mais Con Yellow", price: 25, description: "Sweet yellow corn with butter", stock: 50 },
                    { id: 2, name: "Sweet Corn Pudding and Cakes", price: 30, description: "Soft corn pudding with cake", stock: 30 },
                    { id: 3, name: "Sweetcorn Popcorn", price: 20, description: "Freshly popped sweet corn", stock: 100 },
                    { id: 4, name: "Chao Fan Sweetcorn Rice", price: 40, description: "Fried rice with sweet corn", stock: 25 }
                ]
            },
            {
                id: 2,
                name: "JAC N' JELL FOOD HOUSE",
                icon: "fas fa-utensils",
                description: "Rice meals and refreshing drinks",
                category: "fastfood",
                rating: 4.3,
                status: "open",
                deliveryTime: "20-25 mins",
                priceRange: "",
                menu: [
                    { id: 1, name: "Siomai Rice with Bagoong", price: 45, description: "Steamed siomai with shrimp paste rice", stock: 40 },
                    { id: 2, name: "Lemonade Juice", price: 20, description: "Freshly squeezed lemonade", stock: 80 },
                    { id: 3, name: "Sandwich Bread", price: 25, description: "Fresh sandwich with fillings", stock: 35 }
                ]
            },
            {
                id: 3,
                name: "FRESH FRUIT SALAD & SHAKE",
                icon: "fas fa-blender",
                description: "Healthy fruit options and shakes",
                category: "drinks",
                rating: 4.7,
                status: "open",
                deliveryTime: "10-15 mins",
                priceRange: "",
                menu: [
                    { id: 1, name: "Fruit Shake", price: 35, description: "Mixed fruit shake", stock: 60 }
                ]
            },
            {
                id: 4,
                name: "TUHOG CORNER",
                icon: "fas fa-drumstick-bite",
                description: "Street food favorites on sticks",
                category: "snacks",
                rating: 4.2,
                status: "open",
                deliveryTime: "15-20 mins",
                priceRange: "",
                menu: [
                    { id: 1, name: "Fried Isaw", price: 10, description: "Grilled chicken intestines", stock: 200 },
                    { id: 2, name: "Baga", price: 10, description: "Grilled pork lungs", stock: 150 },
                    { id: 3, name: "Hotdog", price: 15, description: "Grilled hotdog on stick", stock: 120 },
                    { id: 4, name: "Siomai", price: 20, description: "Steamed pork siomai", stock: 90 },
                    { id: 5, name: "Fried Shanghai", price: 25, description: "Deep fried spring rolls", stock: 75 }
                ]
            },
            {
                id: 5,
                name: "SHAWARMA",
                icon: "fas fa-bread-slice",
                description: "Middle eastern delight wrapped in pita",
                category: "fastfood",
                rating: 4.6,
                status: "open",
                deliveryTime: "20-25 mins",
                priceRange: "",
                menu: [
                    { id: 1, name: "Shawarma", price: 60, description: "Chicken shawarma with garlic sauce", stock: 45 }
                ]
            },
            {
                id: 6,
                name: "IL RUTTO",
                icon: "fas fa-ice-cream",
                description: "Desserts and savory snacks",
                category: "desserts",
                rating: 4.4,
                status: "open",
                deliveryTime: "15-20 mins",
                priceRange: "",
                menu: [
                    { id: 1, name: "Soft Serve Ice Cream and Snacks", price: 30, description: "Vanilla soft serve with toppings", stock: 50 },
                    { id: 2, name: "Burger and Fries", price: 55, description: "Beef burger with potato fries", stock: 30 }
                ]
            },
            {
                id: 7,
                name: "DOUBLE G STREET FOODS",
                icon: "fas fa-fish",
                description: "Quick street bites and snacks",
                category: "snacks",
                rating: 4.1,
                status: "open",
                deliveryTime: "10-15 mins",
                priceRange: "",
                menu: [
                    { id: 1, name: "Kikiam", price: 10, description: "Deep fried fish rolls", stock: 180 },
                    { id: 2, name: "Fishball", price: 10, description: "Fried fish balls with sauce", stock: 200 }
                ]
            },
            {
                id: 8,
                name: "ELMA'S TAKOYAKI & JAPANESE CAKE",
                icon: "fas fa-birthday-cake",
                description: "Japanese street food specialties",
                category: "snacks",
                rating: 4.8,
                status: "open",
                deliveryTime: "20-25 mins",
                priceRange: "",
                menu: [
                    { id: 1, name: "Takoyaki", price: 40, description: "Octopus balls with sauce", stock: 40 },
                    { id: 2, name: "Japanese Cake", price: 20, description: "Soft Japanese sponge cake", stock: 65 }
                ]
            },
            {
                id: 9,
                name: "ENJOY KIDDOS' HUB",
                icon: "fas fa-hamburger",
                description: "Family favorites and comfort food",
                category: "fastfood",
                rating: 4.5,
                status: "open",
                deliveryTime: "25-30 mins",
                priceRange: "",
                menu: [
                    { id: 1, name: "Pastil", price: 20, description: "Shredded chicken with rice", stock: 55 },
                    { id: 2, name: "Fried Chicken", price: 60, description: "Crispy fried chicken", stock: 35 },
                    { id: 3, name: "Chicken Curry", price: 70, description: "Spicy chicken curry", stock: 25 },
                    { id: 4, name: "Humba", price: 65, description: "Braised pork belly", stock: 20 },
                    { id: 5, name: "Hot Cake", price: 15, description: "Fluffy pancakes", stock: 70 }
                ]
            },
            {
                id: 10,
                name: "TAG'Z FRUIT",
                icon: "fas fa-apple-alt",
                description: "Fresh fruit slices and salads",
                category: "snacks",
                rating: 4.9,
                status: "open",
                deliveryTime: "10-15 mins",
                priceRange: "",
                menu: [
                    { id: 1, name: "Manga Slice", price: 20, description: "Fresh mango slices", stock: 85 },
                    { id: 2, name: "Pinya Slice", price: 25, description: "Sweet pineapple slices", stock: 60 },
                    { id: 3, name: "Bayabas Slice", price: 15, description: "Guava slices", stock: 45 },
                    { id: 4, name: "Santol Slice", price: 20, description: "Santol fruit slices", stock: 30 }
                ]
            }
        ];

        // ====== DATABASE FUNCTIONS ======
        
        let db = null;

        async function initDatabase() {
            return new Promise((resolve, reject) => {
                const request = indexedDB.open(DB_NAME, DB_VERSION);
                
                request.onerror = (event) => {
                    console.error('Database error:', event.target.error);
                    updateDatabaseStatus(false);
                    reject(event.target.error);
                };
                
                request.onsuccess = (event) => {
                    db = event.target.result;
                    updateDatabaseStatus(true);
                    
                    // Check if stores are already added
                    const transaction = db.transaction(['stores'], 'readonly');
                    const objectStore = transaction.objectStore('stores');
                    const countRequest = objectStore.count();
                    
                    countRequest.onsuccess = () => {
                        if (countRequest.result === 0) {
                            // Initialize with default data
                            initializeDefaultData();
                        }
                        resolve(db);
                    };
                    
                    countRequest.onerror = () => {
                        initializeDefaultData();
                        resolve(db);
                    };
                };
                
                request.onupgradeneeded = (event) => {
                    const db = event.target.result;
                    
                    // Create object stores
                    for (const [storeName, schema] of Object.entries(DB_SCHEMA)) {
                        if (!db.objectStoreNames.contains(storeName)) {
                            const objectStore = db.createObjectStore(storeName, { 
                                keyPath: schema.key,
                                autoIncrement: true 
                            });
                            
                            // Create indexes
                            for (const index of schema.indexes || []) {
                                objectStore.createIndex(index, index, { unique: false });
                            }
                        }
                    }
                };
            });
        }

        function initializeDefaultData() {
            if (!db) return;
            
            const transaction = db.transaction(['stores', 'inventory'], 'readwrite');
            
            // Add stores to database
            const storeStore = transaction.objectStore('stores');
            stores.forEach(store => {
                storeStore.add(store);
            });
            
            // Initialize inventory
            const inventoryStore = transaction.objectStore('inventory');
            stores.forEach(store => {
                store.menu.forEach(item => {
                    inventoryStore.add({
                        storeId: store.id,
                        storeName: store.name,
                        itemId: item.id,
                        itemName: item.name,
                        price: item.price,
                        stock: item.stock,
                        lastUpdated: new Date().toISOString(),
                        status: item.stock > 0 ? 'In Stock' : 'Out of Stock'
                    });
                });
            });
        }

        function updateDatabaseStatus(connected) {
            isDatabaseConnected = connected;
            const statusElement = document.getElementById('db-status');
            const dashboardStatus = document.getElementById('dashboard-db-status');
            
            if (connected) {
                statusElement.className = 'db-status connected';
                statusElement.innerHTML = '<i class="fas fa-database"></i> Database: Connected';
                dashboardStatus.className = 'db-status connected';
                dashboardStatus.innerHTML = '<i class="fas fa-database"></i> Database: Connected';
            } else {
                statusElement.className = 'db-status disconnected';
                statusElement.innerHTML = '<i class="fas fa-database"></i> Database: Disconnected';
                dashboardStatus.className = 'db-status disconnected';
                dashboardStatus.innerHTML = '<i class="fas fa-database"></i> Database: Disconnected';
            }
        }

        // Database CRUD Operations
        async function addToDatabase(storeName, data) {
            if (!db) return;
            
            return new Promise((resolve, reject) => {
                const transaction = db.transaction([storeName], 'readwrite');
                const objectStore = transaction.objectStore(storeName);
                const request = objectStore.add(data);
                
                request.onsuccess = () => resolve(request.result);
                request.onerror = () => reject(request.error);
            });
        }

        async function getAllFromDatabase(storeName) {
            if (!db) return [];
            
            return new Promise((resolve, reject) => {
                const transaction = db.transaction([storeName], 'readonly');
                const objectStore = transaction.objectStore(storeName);
                const request = objectStore.getAll();
                
                request.onsuccess = () => resolve(request.result);
                request.onerror = () => reject(request.error);
            });
        }

        async function updateInDatabase(storeName, id, data) {
            if (!db) return;
            
            return new Promise((resolve, reject) => {
                const transaction = db.transaction([storeName], 'readwrite');
                const objectStore = transaction.objectStore(storeName);
                const getRequest = objectStore.get(id);
                
                getRequest.onsuccess = () => {
                    const existing = getRequest.result;
                    const updated = { ...existing, ...data };
                    const updateRequest = objectStore.put(updated);
                    
                    updateRequest.onsuccess = () => resolve(updateRequest.result);
                    updateRequest.onerror = () => reject(updateRequest.error);
                };
                
                getRequest.onerror = () => reject(getRequest.error);
            });
        }

        async function deleteFromDatabase(storeName, id) {
            if (!db) return;
            
            return new Promise((resolve, reject) => {
                const transaction = db.transaction([storeName], 'readwrite');
                const objectStore = transaction.objectStore(storeName);
                const request = objectStore.delete(id);
                
                request.onsuccess = () => resolve(true);
                request.onerror = () => reject(request.error);
            });
        }

        async function searchInDatabase(storeName, indexName, value) {
            if (!db) return [];
            
            return new Promise((resolve, reject) => {
                const transaction = db.transaction([storeName], 'readonly');
                const objectStore = transaction.objectStore(storeName);
                const index = objectStore.index(indexName);
                const request = index.getAll(value);
                
                request.onsuccess = () => resolve(request.result);
                request.onerror = () => reject(request.error);
            });
        }

        // ====== SCREEN NAVIGATION ======
        
        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.add('hidden');
            });
            document.getElementById(screenId).classList.remove('hidden');
            
            // Refresh dashboard if showing
            if (screenId === 'admin-dashboard') {
                loadDashboardData();
            }
        }

        function showAuthOptions() {
            showScreen('auth-screen');
        }

        function showRegister() {
            closeGuestRestriction();
            selectRole('student');
            showScreen('register-screen');
        }

        function showLogin() {
            closeGuestRestriction();
            showScreen('login-screen');
        }

        function showAdminLogin() {
            showScreen('admin-login-screen');
        }

        function backToWelcome() {
            showScreen('welcome-screen');
        }

        function backToAuth() {
            showScreen('auth-screen');
        }

        function exitApp() {
            if (confirm('Are you sure you want to exit NEMSU Chow Zone?')) {
                showAlert('Thank you!', 'Thank you for visiting NEMSU Chow Zone. See you again!', 'info');
                setTimeout(() => {
                    document.body.innerHTML = `
                        <div style="display: flex; justify-content: center; align-items: center; height: 100vh; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; text-align: center;">
                            <div>
                                <h1 style="font-size: 3rem;"></h1>
                                <h2>Thank you for visiting NEMSU CHOW ZONE!</h2>
                                <p>System closed</p>
                            </div>
                        </div>
                    `;
                }, 2000);
            }
        }

        function showAbout() {
            showAlert('About NEMSU Chow Zone', 
                'A food ordering system for NEMSU students and instructors. Features include student/instructor registration, multiple store selection, online payment integration, and admin dashboard.', 
                'info');
        }

        // ====== GUEST FUNCTIONS ======
        
        function continueAsGuest() {
            currentUser = null;
            isGuestMode = true;
            cart = []; // Clear cart for guest
            showStores();
        }

        function showGuestRestriction() {
            document.getElementById('guest-restriction-modal').classList.remove('hidden');
        }

        function closeGuestRestriction() {
            document.getElementById('guest-restriction-modal').classList.add('hidden');
        }

        function checkUserAuthentication(action) {
            if (isGuestMode || !currentUser) {
                showGuestRestriction();
                return false;
            }
            return true;
        }

        // ====== ADMIN FUNCTIONS ======
        
        async function adminLogin(event) {
            event.preventDefault();
            
            const username = document.getElementById('admin-username').value;
            const password = document.getElementById('admin-password').value;
            
            // Default admin credentials
            if (username === 'admin' && password === 'admin123') {
                try {
                    await initDatabase();
                    showScreen('admin-dashboard');
                    showAlert('Admin Login Successful', 'Welcome to Admin Dashboard!', 'success');
                } catch (error) {
                    showAlert('Database Error', 'Could not initialize database. Using local storage instead.', 'warning');
                    showScreen('admin-dashboard');
                }
            } else {
                showAlert('Login Failed', 'Invalid admin credentials', 'error');
            }
        }

        function adminLogout() {
            if (confirm('Are you sure you want to logout from admin panel?')) {
                showScreen('welcome-screen');
            }
        }

        async function loadDashboardData() {
            try {
                // Load data from database
                const users = await getAllFromDatabase('users');
                const orders = await getAllFromDatabase('orders');
                const inventory = await getAllFromDatabase('inventory');
                
                // Update stats
                document.getElementById('total-users').textContent = users.length;
                document.getElementById('total-orders').textContent = orders.length;
                document.getElementById('total-stores').textContent = stores.length;
                
                // Calculate total revenue
                const totalRevenue = orders.reduce((sum, order) => sum + (order.total || 0), 0);
                document.getElementById('total-revenue').textContent = `${totalRevenue.toFixed(2)}`;
                
                // Load users table
                renderUsersTable(users);
                
                // Load orders table
                renderOrdersTable(orders);
                
                // Load inventory table
                renderInventoryTable(inventory);
                
                // Update charts
                updateSalesChart(orders);
                updateAnalytics();
                
            } catch (error) {
                console.error('Error loading dashboard data:', error);
                
                // Fallback to localStorage
                const users = JSON.parse(localStorage.getItem('nemsuUsers') || '[]');
                const orders = JSON.parse(localStorage.getItem('nemsuOrders') || '[]');
                
                document.getElementById('total-users').textContent = users.length;
                document.getElementById('total-orders').textContent = orders.length;
                document.getElementById('total-stores').textContent = stores.length;
                
                const totalRevenue = orders.reduce((sum, order) => sum + (order.total || 0), 0);
                document.getElementById('total-revenue').textContent = `${totalRevenue.toFixed(2)}`;
            }
        }

        function renderUsersTable(users) {
            const tbody = document.getElementById('users-table-body');
            tbody.innerHTML = '';
            
            users.forEach(user => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${user.id}</td>
                    <td>${user.firstName} ${user.lastName}</td>
                    <td>${user.email}</td>
                    <td><span class="badge ${user.role === 'admin' ? 'badge-warning' : 'badge-success'}">${user.role}</span></td>
                    <td>${user.phone || 'N/A'}</td>
                    <td>${new Date(user.registrationDate).toLocaleDateString()}</td>
                    <td>
                        <button onclick="viewUserDetails(${user.id})" class="btn-sm" style="background: var(--info); color: white; border: none; padding: 0.25rem 0.5rem; border-radius: var(--radius); cursor: pointer; margin-right: 0.25rem;">
                            <i class="fas fa-eye"></i>
                        </button>
                        <button onclick="deleteUser(${user.id})" class="btn-sm" style="background: var(--danger); color: white; border: none; padding: 0.25rem 0.5rem; border-radius: var(--radius); cursor: pointer;">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        function renderOrdersTable(orders) {
            const tbody = document.getElementById('orders-table-body');
            tbody.innerHTML = '';
            
            orders.forEach(order => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${order.id}</td>
                    <td>${order.customer?.firstName || 'Guest'} ${order.customer?.lastName || ''}</td>
                    <td>${order.items?.length || 0} items</td>
                    <td>${order.total?.toFixed(2) || '0.00'}</td>
                    <td>${order.paymentMethod || 'N/A'}</td>
                    <td><span class="badge badge-success">${order.status || 'Completed'}</span></td>
                    <td>${new Date(order.date).toLocaleDateString()}</td>
                    <td>
                        <button onclick="viewOrderDetails('${order.id}')" class="btn-sm" style="background: var(--info); color: white; border: none; padding: 0.25rem 0.5rem; border-radius: var(--radius); cursor: pointer; margin-right: 0.25rem;">
                            <i class="fas fa-eye"></i>
                        </button>
                        <button onclick="printOrder('${order.id}')" class="btn-sm" style="background: var(--primary); color: white; border: none; padding: 0.25rem 0.5rem; border-radius: var(--radius); cursor: pointer; margin-right: 0.25rem;">
                            <i class="fas fa-print"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        function renderInventoryTable(inventory) {
            const tbody = document.getElementById('inventory-table-body');
            tbody.innerHTML = '';
            
            inventory.forEach(item => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${item.storeName}</td>
                    <td>${item.itemName}</td>
                    <td>${item.price}</td>
                    <td>${item.stock}</td>
                    <td><span class="badge ${item.stock > 10 ? 'badge-success' : item.stock > 0 ? 'badge-warning' : 'badge-danger'}">${item.status || (item.stock > 0 ? 'In Stock' : 'Out of Stock')}</span></td>
                    <td>${new Date(item.lastUpdated).toLocaleDateString()}</td>
                    <td>
                        <button onclick="updateInventoryStock(${item.id})" class="btn-sm" style="background: var(--secondary); color: white; border: none; padding: 0.25rem 0.5rem; border-radius: var(--radius); cursor: pointer; margin-right: 0.25rem;">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button onclick="restockItem(${item.id})" class="btn-sm" style="background: var(--info); color: white; border: none; padding: 0.25rem 0.5rem; border-radius: var(--radius); cursor: pointer;">
                            <i class="fas fa-box"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        function updateSalesChart(orders) {
            const ctx = document.getElementById('salesChart').getContext('2d');
            
            // Group orders by date
            const salesByDate = {};
            orders.forEach(order => {
                const date = new Date(order.date).toLocaleDateString();
                salesByDate[date] = (salesByDate[date] || 0) + (order.total || 0);
            });
            
            const dates = Object.keys(salesByDate).slice(-7); // Last 7 days
            const amounts = dates.map(date => salesByDate[date]);
            
            if (salesChart) {
                salesChart.destroy();
            }
            
            salesChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: dates,
                    datasets: [{
                        label: 'Daily Sales ()',
                        data: amounts,
                        borderColor: 'rgb(79, 70, 229)',
                        backgroundColor: 'rgba(79, 70, 229, 0.1)',
                        tension: 0.1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return '' + value;
                                }
                            }
                        }
                    }
                }
            });
        }

        function updateAnalytics() {
            const range = document.getElementById('analytics-range').value;
            const type = document.getElementById('analytics-type').value;
            
            const ctx = document.getElementById('analyticsChart').getContext('2d');
            
            if (analyticsChart) {
                analyticsChart.destroy();
            }
            
            let data, labels, chartType;
            
            switch(type) {
                case 'sales':
                    chartType = 'bar';
                    labels = ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'];
                    data = [1200, 1900, 1500, 2000, 1800, 2200, 2500];
                    break;
                case 'users':
                    chartType = 'line';
                    labels = ['Week 1', 'Week 2', 'Week 3', 'Week 4'];
                    data = [50, 75, 100, 150];
                    break;
                case 'popular':
                    chartType = 'doughnut';
                    labels = ['Shawarma', 'Burger', 'Siomai', 'Fruit Shake', 'Takoyaki'];
                    data = [45, 35, 60, 40, 25];
                    break;
            }
            
            analyticsChart = new Chart(ctx, {
                type: chartType,
                data: {
                    labels: labels,
                    datasets: [{
                        label: type === 'sales' ? 'Sales ()' : 
                               type === 'users' ? 'New Users' : 'Popularity',
                        data: data,
                        backgroundColor: type === 'popular' ? [
                            'rgb(79, 70, 229)',
                            'rgb(16, 185, 129)',
                            'rgb(245, 158, 11)',
                            'rgb(59, 130, 246)',
                            'rgb(239, 68, 68)'
                        ] : 'rgb(79, 70, 229)',
                        borderColor: 'rgb(255, 255, 255)',
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
        }

        function showTab(tabName, event) {
            // Update tab buttons
            document.querySelectorAll('.admin-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // Show selected tab content
            document.querySelectorAll('.tab-pane').forEach(pane => {
                pane.classList.remove('active');
            });
            document.getElementById(`${tabName}-tab`).classList.add('active');
        }

        function searchUsers() {
            const searchTerm = document.getElementById('user-search').value.toLowerCase();
            const rows = document.querySelectorAll('#users-table-body tr');
            
            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(searchTerm) ? '' : 'none';
            });
        }

        function searchOrders() {
            const searchTerm = document.getElementById('order-search').value.toLowerCase();
            const rows = document.querySelectorAll('#orders-table-body tr');
            
            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(searchTerm) ? '' : 'none';
            });
        }

        function searchInventory() {
            const searchTerm = document.getElementById('inventory-search').value.toLowerCase();
            const rows = document.querySelectorAll('#inventory-table-body tr');
            
            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(searchTerm) ? '' : 'none';
            });
        }

        async function syncDatabase() {
            try {
                showAlert('Syncing...', 'Syncing data with database...', 'info');
                
                // Sync users
                const localUsers = JSON.parse(localStorage.getItem('nemsuUsers') || '[]');
                for (const user of localUsers) {
                    await addToDatabase('users', user);
                }
                
                // Sync orders
                const localOrders = JSON.parse(localStorage.getItem('nemsuOrders') || '[]');
                for (const order of localOrders) {
                    await addToDatabase('orders', order);
                }
                
                // Refresh dashboard
                await loadDashboardData();
                
                showAlert('Sync Complete', 'Data synchronized successfully!', 'success');
            } catch (error) {
                showAlert('Sync Failed', 'Error syncing data: ' + error.message, 'error');
            }
        }

        function exportData() {
            // Create export data
            const exportData = {
                timestamp: new Date().toISOString(),
                users: JSON.parse(localStorage.getItem('nemsuUsers') || '[]'),
                orders: JSON.parse(localStorage.getItem('nemsuOrders') || '[]'),
                system: 'NEMSU Food Ordering System'
            };
            
            // Create download link
            const dataStr = JSON.stringify(exportData, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            const exportFileDefaultName = `nemsu_data_${new Date().toISOString().split('T')[0]}.json`;
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
            
            showAlert('Export Successful', 'Data exported successfully!', 'success');
        }

        // ====== ADDED FUNCTIONS FOR ADMIN DASHBOARD ACTION BUTTONS ======

        async function viewUserDetails(userId) {
            try {
                const users = await getAllFromDatabase('users') || 
                             JSON.parse(localStorage.getItem('nemsuUsers') || '[]');
                const user = users.find(u => u.id === userId);
                
                if (user) {
                    const details = `
                        ID: ${user.id}
                        Name: ${user.firstName} ${user.lastName} ${user.middleName}
                        Email: ${user.email}
                        Phone: ${user.phone}
                        Age: ${user.age}
                        Role: ${user.role}
                        Course/Department: ${user.course || user.department || 'N/A'}
                        Registered: ${new Date(user.registrationDate).toLocaleDateString()}
                    `;
                    showAlert('User Details', details, 'info');
                } else {
                    showAlert('Error', 'User not found!', 'error');
                }
            } catch (error) {
                showAlert('Error', 'Failed to load user details: ' + error.message, 'error');
            }
        }

        async function deleteUser(userId) {
            if (confirm('Are you sure you want to delete this user?')) {
                try {
                    if (isDatabaseConnected && db) {
                        await deleteFromDatabase('users', userId);
                    }
                    
                    // Also remove from localStorage
                    const users = JSON.parse(localStorage.getItem('nemsuUsers') || '[]');
                    const updatedUsers = users.filter(u => u.id !== userId);
                    localStorage.setItem('nemsuUsers', JSON.stringify(updatedUsers));
                    
                    showAlert('Success', 'User deleted successfully!', 'success');
                    loadDashboardData();
                } catch (error) {
                    showAlert('Error', 'Failed to delete user: ' + error.message, 'error');
                }
            }
        }

        async function viewOrderDetails(orderId) {
            try {
                const orders = await getAllFromDatabase('orders') || 
                              JSON.parse(localStorage.getItem('nemsuOrders') || '[]');
                const order = orders.find(o => o.id === orderId);
                
                if (order) {
                    let items = '';
                    order.items?.forEach(item => {
                        items += `${item.quantity}x ${item.itemName} - ${item.price * item.quantity}\n`;
                    });
                    
                    const details = `
                        Order ID: ${order.id}
                        Customer: ${order.customer?.firstName || 'Guest'} ${order.customer?.lastName || ''}
                        Phone: ${order.phone}
                        Address: ${order.address}
                        Payment: ${order.paymentMethod}
                        Total: ${order.total}
                        Date: ${new Date(order.date).toLocaleString()}
                        Items:\n${items}
                    `;
                    showAlert('Order Details', details, 'info');
                } else {
                    showAlert('Error', 'Order not found!', 'error');
                }
            } catch (error) {
                showAlert('Error', 'Failed to load order details: ' + error.message, 'error');
            }
        }

        function printOrder(orderId) {
            showAlert('Print Feature', 'Print functionality would open the order receipt for printing.', 'info');
        }

        async function updateInventoryStock(inventoryId) {
            const newStock = prompt('Enter new stock quantity:');
            if (newStock !== null && !isNaN(newStock)) {
                try {
                    if (isDatabaseConnected && db) {
                        await updateInDatabase('inventory', inventoryId, {
                            stock: parseInt(newStock),
                            status: newStock > 0 ? 'In Stock' : 'Out of Stock',
                            lastUpdated: new Date().toISOString()
                        });
                    }
                    
                    showAlert('Success', 'Inventory stock updated!', 'success');
                    loadDashboardData();
                } catch (error) {
                    showAlert('Error', 'Failed to update inventory: ' + error.message, 'error');
                }
            }
        }

        async function restockItem(inventoryId) {
            const addStock = prompt('Enter quantity to add:');
            if (addStock !== null && !isNaN(addStock)) {
                try {
                    if (isDatabaseConnected && db) {
                        const inventory = await getAllFromDatabase('inventory');
                        const item = inventory.find(i => i.id === inventoryId);
                        
                        if (item) {
                            const newStock = item.stock + parseInt(addStock);
                            await updateInDatabase('inventory', inventoryId, {
                                stock: newStock,
                                status: newStock > 0 ? 'In Stock' : 'Out of Stock',
                                lastUpdated: new Date().toISOString()
                            });
                            
                            showAlert('Success', `Item restocked! New stock: ${newStock}`, 'success');
                            loadDashboardData();
                        }
                    }
                } catch (error) {
                    showAlert('Error', 'Failed to restock item: ' + error.message, 'error');
                }
            }
        }

        async function updateAllInventory() {
            if (confirm('Update all inventory from current menu data?')) {
                try {
                    if (isDatabaseConnected && db) {
                        // Clear existing inventory
                        const transaction = db.transaction(['inventory'], 'readwrite');
                        const objectStore = transaction.objectStore('inventory');
                        const clearRequest = objectStore.clear();
                        
                        clearRequest.onsuccess = () => {
                            // Add all current items
                            stores.forEach(store => {
                                store.menu.forEach(item => {
                                    addToDatabase('inventory', {
                                        storeId: store.id,
                                        storeName: store.name,
                                        itemId: item.id,
                                        itemName: item.name,
                                        price: item.price,
                                        stock: item.stock,
                                        lastUpdated: new Date().toISOString(),
                                        status: item.stock > 0 ? 'In Stock' : 'Out of Stock'
                                    });
                                });
                            });
                            
                            showAlert('Success', 'All inventory updated!', 'success');
                            loadDashboardData();
                        };
                    }
                } catch (error) {
                    showAlert('Error', 'Failed to update inventory: ' + error.message, 'error');
                }
            }
        }

        // ====== SQLITE EXPORT FUNCTION ======

        function escapeSingleQuotes(str) {
            if (typeof str !== 'string') return str;
            return str.replace(/'/g, "''");
        }

        function exportToSQLite() {
            try {
                // Get all data
                const users = JSON.parse(localStorage.getItem('nemsuUsers') || '[]');
                const orders = JSON.parse(localStorage.getItem('nemsuOrders') || '[]');
                
                // Generate SQL statements
                let sql = `-- NEMSU Chow Zone Database Export
-- Generated: ${new Date().toISOString()}

-- Create tables
CREATE TABLE IF NOT EXISTS users (
    id INTEGER PRIMARY KEY,
    first_name TEXT NOT NULL,
    last_name TEXT NOT NULL,
    middle_name TEXT NOT NULL,
    age INTEGER NOT NULL,
    phone TEXT NOT NULL,
    email TEXT NOT NULL,
    password TEXT NOT NULL,
    role TEXT NOT NULL,
    course TEXT,
    department TEXT,
    registration_date TEXT NOT NULL
);

CREATE TABLE IF NOT EXISTS orders (
    id TEXT PRIMARY KEY,
    date TEXT NOT NULL,
    customer_id INTEGER,
    customer_name TEXT NOT NULL,
    phone TEXT NOT NULL,
    address TEXT NOT NULL,
    payment_method TEXT NOT NULL,
    payment_number TEXT,
    subtotal REAL NOT NULL,
    delivery_fee REAL NOT NULL,
    service_fee REAL NOT NULL,
    total REAL NOT NULL,
    status TEXT NOT NULL,
    FOREIGN KEY (customer_id) REFERENCES users(id)
);

CREATE TABLE IF NOT EXISTS order_items (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    order_id TEXT NOT NULL,
    store_id INTEGER NOT NULL,
    store_name TEXT NOT NULL,
    item_id INTEGER NOT NULL,
    item_name TEXT NOT NULL,
    price REAL NOT NULL,
    quantity INTEGER NOT NULL,
    FOREIGN KEY (order_id) REFERENCES orders(id)
);

CREATE TABLE IF NOT EXISTS stores (
    id INTEGER PRIMARY KEY,
    name TEXT NOT NULL,
    icon TEXT NOT NULL,
    description TEXT NOT NULL,
    category TEXT NOT NULL,
    rating REAL NOT NULL,
    status TEXT NOT NULL,
    delivery_time TEXT NOT NULL,
    price_range TEXT NOT NULL
);

CREATE TABLE IF NOT EXISTS menu_items (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    store_id INTEGER NOT NULL,
    name TEXT NOT NULL,
    price REAL NOT NULL,
    description TEXT NOT NULL,
    stock INTEGER NOT NULL,
    FOREIGN KEY (store_id) REFERENCES stores(id)
);

-- Insert users
`;
                
                // Insert users
                users.forEach(user => {
                    sql += `INSERT INTO users (id, first_name, last_name, middle_name, age, phone, email, password, role, ${user.course ? 'course' : 'department'}, registration_date) VALUES (
    ${user.id},
    '${escapeSingleQuotes(user.firstName)}',
    '${escapeSingleQuotes(user.lastName)}',
    '${escapeSingleQuotes(user.middleName)}',
    ${user.age},
    '${user.phone}',
    '${user.email}',
    '${user.password}',
    '${user.role}',
    '${escapeSingleQuotes(user.course || user.department || '')}',
    '${user.registrationDate}'
);\n`;
                });
                
                sql += "\n-- Insert stores\n";
                stores.forEach(store => {
                    sql += `INSERT INTO stores (id, name, icon, description, category, rating, status, delivery_time, price_range) VALUES (
    ${store.id},
    '${escapeSingleQuotes(store.name)}',
    '${store.icon}',
    '${escapeSingleQuotes(store.description)}',
    '${store.category}',
    ${store.rating},
    '${store.status}',
    '${store.deliveryTime}',
    '${store.priceRange}'
);\n`;
                    
                    // Insert menu items
                    store.menu.forEach(item => {
                        sql += `INSERT INTO menu_items (store_id, name, price, description, stock) VALUES (
    ${store.id},
    '${escapeSingleQuotes(item.name)}',
    ${item.price},
    '${escapeSingleQuotes(item.description)}',
    ${item.stock}
);\n`;
                    });
                });
                
                sql += "\n-- Insert orders\n";
                orders.forEach(order => {
                    sql += `INSERT INTO orders (id, date, customer_id, customer_name, phone, address, payment_method, payment_number, subtotal, delivery_fee, service_fee, total, status) VALUES (
    '${order.id}',
    '${order.date}',
    ${order.customer?.id || 'NULL'},
    '${escapeSingleQuotes((order.customer?.firstName || 'Guest') + ' ' + (order.customer?.lastName || ''))}',
    '${order.phone}',
    '${escapeSingleQuotes(order.address)}',
    '${order.paymentMethod}',
    '${order.paymentNumber || ''}',
    ${order.subtotal},
    ${order.deliveryFee},
    ${order.serviceFee},
    ${order.total},
    '${order.status}'
);\n`;
                    
                    // Insert order items
                    order.items?.forEach(item => {
                        sql += `INSERT INTO order_items (order_id, store_id, store_name, item_id, item_name, price, quantity) VALUES (
    '${order.id}',
    ${item.storeId},
    '${escapeSingleQuotes(item.storeName)}',
    ${item.itemId},
    '${escapeSingleQuotes(item.itemName)}',
    ${item.price},
    ${item.quantity}
);\n`;
                    });
                });
                
                // Create download link
                const blob = new Blob([sql], { type: 'application/sql' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `nemsu_chowzone_${new Date().toISOString().split('T')[0]}.sql`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                showAlert('Export Successful', 'SQL file downloaded successfully! You can import this into SQLite or MySQL database.', 'success');
            } catch (error) {
                showAlert('Export Failed', 'Error exporting data: ' + error.message, 'error');
            }
        }

        // ====== REGISTRATION FUNCTIONS ======
        
        function selectRole(role) {
            userRole = role;
            
            // Update UI
            document.querySelectorAll('.role-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            if (role === 'student') {
                document.getElementById('student-tab').classList.add('active');
                document.getElementById('academic-fields').innerHTML = `
                    <div class="form-group">
                        <label>Course <span class="required">*</span></label>
                        <select id="course" required>
                            <option value="">Select Course</option>
                            <option value="BSIT">BS Information Technology</option>
                            <option value="BSCS">BS Computer Science</option>
                            <option value="BSIS">BS Information Systems</option>
                            <option value="BSCpE">BS Computer Engineering</option>
                            <option value="BSEd">BS Education</option>
                            <option value="BSBA">BS Business Administration</option>
                            <option value="BSA">BS Accountancy</option>
                        </select>
                    </div>
                `;
            } else {
                document.getElementById('instructor-tab').classList.add('active');
                document.getElementById('academic-fields').innerHTML = `
                    <div class="form-group">
                        <label>Department <span class="required">*</span></label>
                        <select id="department" required>
                            <option value="">Select Department</option>
                            <option value="CCS">College of Computer Studies</option>
                            <option value="CIT">College of Industrial Technology</option>
                            <option value="CEA">College of Engineering & Architecture</option>
                            <option value="CBEAS">College of Business, Economics & Accountancy</option>
                            <option value="CTE">College of Teacher Education</option>
                            <option value="CON">College of Nursing</option>
                        </select>
                    </div>
                `;
            }
        }

        // ====== VALIDATION FUNCTIONS ======
        
        function validateEmail(email) {
            return email.endsWith('@gmail.com');
        }

        function validatePassword(password) {
            return password.length >= 4 && password.length <= 21;
        }

        function validatePhone(phone) {
            return /^09[0-9]{9}$/.test(phone);
        }

        // ====== REGISTRATION FORM ======
        
        async function registerUser(event) {
            event.preventDefault();
            
            const firstName = document.getElementById('first-name').value;
            const lastName = document.getElementById('last-name').value;
            const middleName = document.getElementById('middle-name').value;
            const age = parseInt(document.getElementById('age').value);
            const phone = document.getElementById('phone').value;
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            const confirmPassword = document.getElementById('confirm-password').value;
            
            // Validations
            if (!validateEmail(email)) {
                showAlert('Invalid Email', 'Email must end with @gmail.com', 'error');
                return;
            }
            
            if (!validatePassword(password)) {
                showAlert('Invalid Password', 'Password must be 4-21 characters long', 'error');
                return;
            }
            
            if (password !== confirmPassword) {
                showAlert('Password Mismatch', 'Passwords do not match', 'error');
                return;
            }
            
            if (!validatePhone(phone)) {
                showAlert('Invalid Phone', 'Phone must be 11 digits starting with 09', 'error');
                return;
            }
            
            if (age < 15 || age > 80) {
                showAlert('Invalid Age', 'Age must be between 15 and 80', 'error');
                return;
            }
            
            // Create user object
            const userData = {
                id: Date.now(),
                firstName,
                lastName,
                middleName,
                age,
                phone,
                email,
                password,
                role: userRole,
                registrationDate: new Date().toISOString()
            };
            
            if (userRole === 'student') {
                userData.course = document.getElementById('course').value;
            } else {
                userData.department = document.getElementById('department').value;
            }
            
            // Save to localStorage
            const users = JSON.parse(localStorage.getItem('nemsuUsers') || '[]');
            users.push(userData);
            localStorage.setItem('nemsuUsers', JSON.stringify(users));
            
            // Save to database if connected
            if (isDatabaseConnected) {
                try {
                    await addToDatabase('users', userData);
                } catch (error) {
                    console.error('Error saving to database:', error);
                }
            }
            
            showAlert('Registration Successful', 
                `${userRole === 'student' ? 'Student' : 'Instructor'} account created successfully! You can now login.`, 
                'success');
            
            // Auto login
            currentUser = userData;
            isGuestMode = false;
            localStorage.setItem('currentUser', JSON.stringify(currentUser));
            
            // Show stores
            setTimeout(() => {
                showStores();
            }, 1500);
        }

        // ====== LOGIN FUNCTIONS ======
        
        function loginUser(event) {
            event.preventDefault();
            
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;
            
            const users = JSON.parse(localStorage.getItem('nemsuUsers') || '[]');
            const user = users.find(u => u.email === email && u.password === password);
            
            if (user) {
                currentUser = user;
                isGuestMode = false;
                localStorage.setItem('currentUser', JSON.stringify(currentUser));
                showAlert('Login Successful', `Welcome back, ${user.firstName}!`, 'success');
                setTimeout(() => {
                    showStores();
                }, 1500);
            } else {
                showAlert('Login Failed', 'Invalid email or password', 'error');
            }
        }

        // ====== STORES FUNCTIONS ======
        
        function showStores() {
            showScreen('stores-screen');
            renderStores();
            updateUserDisplay();
            updateCartCount();
        }

        function renderStores() {
            const container = document.getElementById('stores-list');
            
            if (stores.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 3rem;">
                        <i class="fas fa-store-slash fa-3x" style="color: var(--gray-400);"></i>
                        <h3>No stores available</h3>
                        <p>Please check back later</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = stores.map(store => `
                <div class="store-card" onclick="openStore(${store.id})">
                    <div class="store-header">
                        <div class="store-icon">
                            <i class="${store.icon}"></i>
                        </div>
                        <div class="store-info">
                            <h3>${store.name}</h3>
                            <div class="store-rating">
                                <i class="fas fa-star" style="color: var(--warning);"></i> ${store.rating}
                            </div>
                        </div>
                    </div>
                    <div class="store-body">
                        <p class="store-description">${store.description}</p>
                        <div class="store-tags">
                            <span class="store-tag">${store.category}</span>
                            <span class="store-tag">${store.priceRange}</span>
                            <span class="store-tag">${store.deliveryTime}</span>
                        </div>
                    </div>
                    <div class="store-footer">
                        <span class="store-status ${store.status}">
                            <i class="fas fa-circle"></i> ${store.status.toUpperCase()}
                        </span>
                        <button class="btn-primary btn-sm" onclick="event.stopPropagation(); openStore(${store.id})">
                            View Menu
                        </button>
                    </div>
                </div>
            `).join('');
        }

        function openStore(storeId) {
            currentStore = stores.find(store => store.id === storeId);
            if (!currentStore) return;
            
            showScreen('menu-screen');
            renderStoreMenu();
        }

        function renderStoreMenu() {
            document.getElementById('store-name').textContent = currentStore.name;
            document.getElementById('store-description').textContent = currentStore.description;
            document.getElementById('store-icon').innerHTML = `<i class="${currentStore.icon}"></i>`;
            document.getElementById('store-category').textContent = currentStore.category;
            document.getElementById('store-price-range').textContent = currentStore.priceRange;
            
            const container = document.getElementById('menu-list');
            
            if (!currentStore.menu || currentStore.menu.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 3rem;">
                        <i class="fas fa-utensils-slash fa-3x" style="color: var(--gray-400);"></i>
                        <h3>Menu not available</h3>
                        <p>Please check back later</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = currentStore.menu.map(item => {
                const cartItem = cart.find(ci => 
                    ci.itemId === item.id && ci.storeId === currentStore.id
                );
                const quantity = cartItem ? cartItem.quantity : 0;
                
                return `
                    <div class="menu-item">
                        <div class="menu-item-content">
                            <div class="menu-item-header">
                                <div class="menu-item-title">${item.name}</div>
                                <div class="menu-item-price">${item.price}</div>
                            </div>
                            <p class="menu-item-description">${item.description}</p>
                            <div class="menu-item-actions">
                                <div class="quantity-control">
                                    <button class="btn-quantity" onclick="updateQuantity(${item.id}, ${quantity - 1})">
                                        <i class="fas fa-minus"></i>
                                    </button>
                                    <span class="quantity-display">${quantity}</span>
                                    <button class="btn-quantity" onclick="updateQuantity(${item.id}, ${quantity + 1})">
                                        <i class="fas fa-plus"></i>
                                    </button>
                                </div>
                                <button class="btn-add" onclick="updateQuantity(${item.id}, ${quantity + 1})">
                                    <i class="fas fa-cart-plus"></i> Add
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
            
            updateMenuCartCount();
        }

        function updateQuantity(itemId, newQuantity) {
            // Check if user is guest
            if (isGuestMode || !currentUser) {
                if (newQuantity > 0) {
                    showGuestRestriction();
                }
                return;
            }
            
            if (newQuantity < 0) return;
            
            const existingIndex = cart.findIndex(ci => 
                ci.itemId === itemId && ci.storeId === currentStore.id
            );
            
            if (newQuantity === 0 && existingIndex !== -1) {
                cart.splice(existingIndex, 1);
            } else if (existingIndex !== -1) {
                cart[existingIndex].quantity = newQuantity;
            } else if (newQuantity > 0) {
                const item = currentStore.menu.find(m => m.id === itemId);
                cart.push({
                    itemId,
                    storeId: currentStore.id,
                    storeName: currentStore.name,
                    itemName: item.name,
                    price: item.price,
                    quantity: newQuantity
                });
            }
            
            updateCartCount();
            updateMenuCartCount();
            renderStoreMenu();
            saveToLocalStorage();
        }

        // ====== CART FUNCTIONS ======
        
        function updateCartCount() {
            const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
            document.getElementById('cart-count').textContent = totalItems;
        }

        function updateMenuCartCount() {
            const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
            document.getElementById('menu-cart-count').textContent = totalItems;
        }

        function viewCart() {
            if (!checkUserAuthentication('view cart')) return;
            showScreen('cart-screen');
            renderCart();
        }

        function renderCart() {
            const container = document.getElementById('cart-items');
            const subtotal = calculateSubtotal();
            const deliveryFee = 20;
            const serviceFee = 5;
            const total = subtotal + deliveryFee + serviceFee;
            
            if (cart.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 3rem;">
                        <i class="fas fa-shopping-cart fa-3x" style="color: var(--gray-400);"></i>
                        <h3>Your cart is empty</h3>
                        <p>Add items from stores to get started!</p>
                        <button class="btn-primary" onclick="backToStores()" style="margin-top: 1rem;">
                            <i class="fas fa-store"></i> Browse Stores
                        </button>
                    </div>
                `;
            } else {
                container.innerHTML = cart.map((item, index) => `
                    <div class="cart-item">
                        <div class="cart-item-info">
                            <div class="cart-item-header">
                                <div class="cart-item-title">${item.itemName}</div>
                                <div class="cart-item-price">${item.price}</div>
                            </div>
                            <div class="cart-item-store">${item.storeName}</div>
                            <div class="cart-item-actions">
                                <div class="quantity-control">
                                    <button class="btn-quantity" onclick="updateCartItemQuantity(${index}, ${item.quantity - 1})">
                                        <i class="fas fa-minus"></i>
                                    </button>
                                    <span class="quantity-display">${item.quantity}</span>
                                    <button class="btn-quantity" onclick="updateCartItemQuantity(${index}, ${item.quantity + 1})">
                                        <i class="fas fa-plus"></i>
                                    </button>
                                </div>
                                <button class="btn-sm" onclick="removeCartItem(${index})" style="background: var(--danger); color: white; border: none; padding: 0.5rem 1rem; border-radius: var(--radius); cursor: pointer;">
                                    <i class="fas fa-trash"></i> Remove
                                </button>
                            </div>
                        </div>
                        <div class="cart-item-total">
                            ${item.price * item.quantity}
                        </div>
                    </div>
                `).join('');
            }
            
            document.getElementById('cart-subtotal').textContent = `${subtotal.toFixed(2)}`;
            document.getElementById('cart-total').textContent = `${total.toFixed(2)}`;
        }

        function calculateSubtotal() {
            return cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
        }

        function updateCartItemQuantity(index, newQuantity) {
            if (!checkUserAuthentication('update cart')) return;
            
            if (newQuantity < 0) return;
            
            if (newQuantity === 0) {
                cart.splice(index, 1);
            } else {
                cart[index].quantity = newQuantity;
            }
            
            updateCartCount();
            updateMenuCartCount();
            renderCart();
            saveToLocalStorage();
        }

        function removeCartItem(index) {
            if (!checkUserAuthentication('remove from cart')) return;
            
            cart.splice(index, 1);
            updateCartCount();
            updateMenuCartCount();
            renderCart();
            saveToLocalStorage();
        }

        function clearCart() {
            if (!checkUserAuthentication('clear cart')) return;
            
            if (cart.length === 0) return;
            
            if (confirm('Are you sure you want to clear your cart?')) {
                cart = [];
                updateCartCount();
                updateMenuCartCount();
                renderCart();
                saveToLocalStorage();
            }
        }

        function backToStores() {
            showStores();
        }

        function backToMenu() {
            if (currentStore) {
                showScreen('menu-screen');
                renderStoreMenu();
            } else {
                backToStores();
            }
        }

        function backToCart() {
            viewCart();
        }

        // ====== CHECKOUT FUNCTIONS ======
        
        function checkout() {
            if (!checkUserAuthentication('checkout')) return;
            
            if (cart.length === 0) {
                showAlert('Empty Cart', 'Your cart is empty. Add items before checkout.', 'warning');
                return;
            }
            
            showScreen('checkout-screen');
            
            // Pre-fill phone if user is logged in
            if (currentUser && currentUser.phone) {
                document.getElementById('checkout-phone').value = currentUser.phone;
            }
        }

        function selectPayment(method) {
            selectedPayment = method;
            
            // Update UI
            document.querySelectorAll('.payment-option').forEach(option => {
                option.classList.remove('active');
            });
            
            const selectedOption = event.currentTarget;
            selectedOption.classList.add('active');
        }

        async function placeOrder(event) {
            event.preventDefault();
            
            if (!checkUserAuthentication('place order')) return;
            
            const phone = document.getElementById('checkout-phone').value;
            const address = document.getElementById('delivery-address').value;
            
            if (!validatePhone(phone)) {
                showAlert('Invalid Phone', 'Please enter a valid 11-digit phone number starting with 09.', 'error');
                return;
            }
            
            // Validate payment numbers
            let paymentNumber = '';
            if (selectedPayment === 'gcash') {
                paymentNumber = document.getElementById('gcash-number').value;
                if (!validatePhone(paymentNumber)) {
                    showAlert('Invalid GCash', 'Please enter a valid GCash number.', 'error');
                    return;
                }
            } else if (selectedPayment === 'paymaya') {
                paymentNumber = document.getElementById('paymaya-number').value;
                if (!validatePhone(paymentNumber)) {
                    showAlert('Invalid PayMaya', 'Please enter a valid PayMaya wallet number.', 'error');
                    return;
                }
            }
            
            if (!address.trim()) {
                showAlert('Missing Address', 'Please enter a delivery address.', 'error');
                return;
            }
            
            // Generate receipt
            await generateReceipt(phone, address, paymentNumber);
        }

        // ====== RECEIPT FUNCTIONS ======
        
        async function generateReceipt(phone, address, paymentNumber) {
            const orderId = 'NEMSU' + Date.now().toString().slice(-8);
            const now = new Date();
            const dateStr = now.toLocaleDateString('en-PH');
            const timeStr = now.toLocaleTimeString('en-PH');
            const subtotal = calculateSubtotal();
            const deliveryFee = 20;
            const serviceFee = 5;
            const total = subtotal + deliveryFee + serviceFee;
            
            // Update receipt display
            document.getElementById('order-id').textContent = orderId;
            document.getElementById('receipt-date').textContent = `${dateStr} ${timeStr}`;
            document.getElementById('receipt-customer').textContent = currentUser ? 
                `${currentUser.firstName} ${currentUser.lastName}` : 'Guest User';
            document.getElementById('receipt-phone').textContent = phone;
            document.getElementById('receipt-payment').textContent = selectedPayment.toUpperCase();
            document.getElementById('receipt-payment-number').textContent = paymentNumber || 'N/A';
            document.getElementById('receipt-subtotal').textContent = `${subtotal.toFixed(2)}`;
            document.getElementById('receipt-delivery').textContent = `${deliveryFee.toFixed(2)}`;
            document.getElementById('receipt-service').textContent = `${serviceFee.toFixed(2)}`;
            document.getElementById('receipt-total').textContent = `${total.toFixed(2)}`;
            
            // Add receipt items
            const receiptItems = document.getElementById('receipt-items');
            receiptItems.innerHTML = cart.map(item => `
                <div class="receipt-item">
                    <span>${item.quantity}x ${item.itemName} (${item.storeName})</span>
                    <span>${(item.price * item.quantity).toFixed(2)}</span>
                </div>
            `).join('');
            
            // Show receipt screen
            showScreen('receipt-screen');
            
            // Create order object
            const order = {
                id: orderId,
                date: now.toISOString(),
                customer: currentUser || { firstName: 'Guest', lastName: 'User' },
                items: [...cart],
                phone,
                address,
                paymentMethod: selectedPayment,
                paymentNumber: paymentNumber,
                subtotal,
                deliveryFee,
                serviceFee,
                total,
                status: 'Completed'
            };
            
            // Save order to localStorage
            const orders = JSON.parse(localStorage.getItem('nemsuOrders') || '[]');
            orders.push(order);
            localStorage.setItem('nemsuOrders', JSON.stringify(orders));
            
            // Save to database if connected
            if (isDatabaseConnected) {
                try {
                    await addToDatabase('orders', order);
                    
                    // Update inventory in database
                    for (const item of cart) {
                        const inventoryItems = await getAllFromDatabase('inventory');
                        const inventoryItem = inventoryItems.find(i => 
                            i.storeId === item.storeId && i.itemId === item.itemId
                        );
                        
                        if (inventoryItem) {
                            const newStock = inventoryItem.stock - item.quantity;
                            await updateInDatabase('inventory', inventoryItem.id, {
                                stock: newStock,
                                status: newStock > 0 ? 'In Stock' : 'Out of Stock',
                                lastUpdated: new Date().toISOString()
                            });
                        }
                    }
                    
                    // Add transaction record
                    const transaction = {
                        orderId: orderId,
                        paymentMethod: selectedPayment,
                        paymentNumber: paymentNumber,
                        amount: total,
                        date: now.toISOString(),
                        status: 'Completed'
                    };
                    await addToDatabase('transactions', transaction);
                    
                } catch (error) {
                    console.error('Error saving to database:', error);
                }
            }
            
            // Clear cart
            cart = [];
            updateCartCount();
            updateMenuCartCount();
            saveToLocalStorage();
        }

        async function saveToDatabase() {
            try {
                await syncDatabase();
                showAlert('Success', 'Order saved to database successfully!', 'success');
            } catch (error) {
                showAlert('Error', 'Failed to save to database: ' + error.message, 'error');
            }
        }

        function printReceipt() {
            window.print();
        }

        function newOrder() {
            showStores();
        }

        // ====== UTILITY FUNCTIONS ======
        
        function updateUserDisplay() {
            if (currentUser) {
                document.getElementById('user-name').textContent = `${currentUser.firstName} ${currentUser.lastName}`;
                document.getElementById('user-role').textContent = currentUser.role === 'guest' ? 'Guest' : 
                    currentUser.role.charAt(0).toUpperCase() + currentUser.role.slice(1);
            } else if (isGuestMode) {
                document.getElementById('user-name').textContent = 'Guest User';
                document.getElementById('user-role').textContent = 'Guest';
            }
        }

        function logout() {
            if (confirm('Are you sure you want to logout?')) {
                currentUser = null;
                isGuestMode = false;
                cart = [];
                localStorage.removeItem('currentUser');
                localStorage.removeItem('nemsu_cart');
                showScreen('welcome-screen');
            }
        }

        function saveToLocalStorage() {
            localStorage.setItem('nemsu_cart', JSON.stringify(cart));
        }

        function loadFromLocalStorage() {
            const savedCart = localStorage.getItem('nemsu_cart');
            const savedUser = localStorage.getItem('currentUser');
            
            if (savedCart) cart = JSON.parse(savedCart);
            if (savedUser) {
                currentUser = JSON.parse(savedUser);
                isGuestMode = false;
            }
        }

        function showAlert(title, message, type = 'success') {
            const icon = type === 'success' ? 'fas fa-check-circle' :
                        type === 'error' ? 'fas fa-exclamation-circle' :
                        type === 'warning' ? 'fas fa-exclamation-triangle' :
                        'fas fa-info-circle';
            
            const color = type === 'success' ? 'var(--secondary)' :
                         type === 'error' ? 'var(--danger)' :
                         type === 'warning' ? 'var(--warning)' :
                         'var(--info)';
            
            document.getElementById('alert-icon').innerHTML = `<i class="${icon}"></i>`;
            document.getElementById('alert-icon').style.color = color;
            document.getElementById('alert-title').textContent = title;
            document.getElementById('alert-message').textContent = message;
            document.getElementById('alert-modal').classList.remove('hidden');
        }

        function closeAlert() {
            document.getElementById('alert-modal').classList.add('hidden');
        }

        // ====== INITIALIZATION ======
        
        document.addEventListener('DOMContentLoaded', function() {
            loadFromLocalStorage();
            updateCartCount();
            
            // Initialize payment selection
            selectPayment('gcash');
            
            // Check database connection
            initDatabase().catch(() => {
                // Database connection failed, continue with localStorage
                console.log('Using localStorage as fallback');
            });
        });
    </script>
</body>
</html>
